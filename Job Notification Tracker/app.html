<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Job Notification Tracker — built on the KodNest Premium Build System." />
  <title>Job Notification Tracker</title>

  <!-- KodNest Design System (tokens → base → components → layout → states) -->
  <link rel="stylesheet" href="design-system/index.css" />
  <!-- App-level navigation and route shell styles -->
  <link rel="stylesheet" href="app.css" />
  <!-- Phase 4: 60-job dataset (assigns window.JOBS) -->
  <script src="data/jobs.js"></script>
</head>
<body>

  <!-- ══════════════════════════════════════════════
       TOP NAVIGATION BAR
  ══════════════════════════════════════════════ -->
  <nav class="app-nav" role="navigation" aria-label="Main navigation">
    <div class="app-nav__inner">

      <!-- Brand -->
      <a href="#/" class="app-nav__brand" aria-label="Job Notification Tracker home">
        <span class="app-nav__brand-dot" aria-hidden="true"></span>
        <span class="app-nav__brand-name">Job Notification Tracker</span>
      </a>

      <!-- Desktop links -->
      <ul class="app-nav__links" role="list" id="desktop-nav">
        <li class="app-nav__link" data-route="/dashboard">
          <a href="#/dashboard">Dashboard</a>
        </li>
        <li class="app-nav__link" data-route="/saved">
          <a href="#/saved">Saved</a>
        </li>
        <li class="app-nav__link" data-route="/digest">
          <a href="#/digest">Digest</a>
        </li>
        <li class="app-nav__link" data-route="/settings">
          <a href="#/settings">Settings</a>
        </li>
        <li class="app-nav__link" data-route="/proof">
          <a href="#/proof">Proof</a>
        </li>
      </ul>

      <!-- Right slot (reserved for future: bell, avatar) -->
      <div class="app-nav__right" aria-hidden="true"></div>

      <!-- Hamburger (mobile) -->
      <button
        class="app-nav__hamburger"
        id="hamburger-btn"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span class="app-nav__hamburger-bar"></span>
        <span class="app-nav__hamburger-bar"></span>
        <span class="app-nav__hamburger-bar"></span>
      </button>

    </div>
  </nav>

  <!-- Mobile menu drawer (toggled by hamburger) -->
  <div class="app-nav__mobile-menu" id="mobile-menu" role="dialog" aria-label="Mobile navigation" aria-hidden="true">
    <ul class="app-nav__mobile-links" role="list">
      <li class="app-nav__mobile-link" data-route="/dashboard">
        <a href="#/dashboard">Dashboard</a>
      </li>
      <li class="app-nav__mobile-link" data-route="/saved">
        <a href="#/saved">Saved</a>
      </li>
      <li class="app-nav__mobile-link" data-route="/digest">
        <a href="#/digest">Digest</a>
      </li>
      <li class="app-nav__mobile-link" data-route="/settings">
        <a href="#/settings">Settings</a>
      </li>
      <li class="app-nav__mobile-link" data-route="/proof">
        <a href="#/proof">Proof</a>
      </li>
    </ul>
  </div>


  <!-- ══════════════════════════════════════════════
       APP BODY — all route views rendered here
  ══════════════════════════════════════════════ -->
  <div class="app-body">

    <!-- ── Route: / (Home — Landing Page) ─────── -->
    <div class="route-view" data-view="/" id="view-home" role="main" aria-label="Home">
      <div class="landing-hero">
        <span class="landing-hero__eyebrow label text-muted">Job Notification Tracker</span>
        <h1 class="landing-hero__heading">Stop Missing<br>The Right Jobs.</h1>
        <p class="landing-hero__subtext">Precision-matched job discovery delivered daily at 9AM.</p>
        <a href="#/settings" class="btn btn--primary landing-hero__cta">Start Tracking</a>
        <div class="landing-hero__proof">
          <span class="landing-hero__proof-dot" aria-hidden="true"></span>
          <span class="label text-muted">Built for students who are serious about landing the right role</span>
        </div>
      </div>
    </div>

    <!-- ── Route: /dashboard ───────────────────── -->
    <div class="route-view" data-view="/dashboard" id="view-dashboard" role="main" aria-label="Dashboard">

      <!-- Page header -->
      <div class="route-placeholder" style="padding-bottom: 0;">
        <span class="route-placeholder__eyebrow label text-muted">Overview</span>
        <h1 class="route-placeholder__heading">Dashboard</h1>
        <p class="route-placeholder__subtext">60 real Indian tech opportunities. Filter, save, and apply.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>
      </div>

      <!-- Filter bar -->
      <div class="filter-bar" id="filter-bar" role="search" aria-label="Filter jobs">
        <div class="filter-bar__inner">
          <input
            id="filter-keyword"
            type="search"
            class="input filter-bar__search"
            placeholder="Search title or company…"
            aria-label="Search by title or company"
          />
          <select id="filter-location" class="select filter-bar__select" aria-label="Filter by location">
            <option value="">All Locations</option>
            <option>Bangalore</option>
            <option>Hyderabad</option>
            <option>Mumbai</option>
            <option>Pune</option>
            <option>Chennai</option>
            <option>Noida</option>
            <option>Remote</option>
          </select>
          <select id="filter-mode" class="select filter-bar__select" aria-label="Filter by work mode">
            <option value="">All Modes</option>
            <option>Remote</option>
            <option>Hybrid</option>
            <option>Onsite</option>
          </select>
          <select id="filter-experience" class="select filter-bar__select" aria-label="Filter by experience">
            <option value="">All Experience</option>
            <option>Fresher</option>
            <option>0-1</option>
            <option>1-3</option>
            <option>3-5</option>
          </select>
          <select id="filter-source" class="select filter-bar__select" aria-label="Filter by source">
            <option value="">All Sources</option>
            <option>LinkedIn</option>
            <option>Naukri</option>
            <option>Indeed</option>
          </select>
          <select id="filter-sort" class="select filter-bar__select" aria-label="Sort jobs">
            <option value="latest">Latest First</option>
            <option value="oldest">Oldest First</option>
            <option value="az">A → Z (Company)</option>
          </select>
          <span class="filter-bar__count" id="filter-count" aria-live="polite"></span>
        </div>
      </div>

      <!-- Job grid -->
      <div class="job-grid-shell route-placeholder">
        <div id="job-grid" class="job-grid" role="list" aria-label="Job listings"></div>
        <div id="dashboard-empty" class="empty-state" style="display:none;">
          <div class="empty-state__icon" aria-hidden="true">&#9744;</div>
          <p class="empty-state__title">No matching jobs.</p>
          <p class="empty-state__body">Try adjusting your filters to see more results.</p>
        </div>
      </div>

    </div>

    <!-- ── Route: /saved ──────────────────────── -->
    <div class="route-view" data-view="/saved" id="view-saved" role="main" aria-label="Saved jobs">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">Bookmarks</span>
        <h1 class="route-placeholder__heading">Saved Jobs</h1>
        <p class="route-placeholder__subtext">Positions you've bookmarked for review and future application.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>
        <div id="saved-grid" class="job-grid" role="list" aria-label="Saved job listings"></div>
        <div id="saved-empty" class="empty-state">
          <div class="empty-state__icon" aria-hidden="true">&#9825;</div>
          <p class="empty-state__title">Nothing saved yet.</p>
          <p class="empty-state__body">Click “Save” on any job from the Dashboard to bookmark it here.</p>
        </div>
      </div>
    </div>

    <!-- ── Route: /digest ────────────────────── -->
    <div class="route-view" data-view="/digest" id="view-digest" role="main" aria-label="Digest">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">Daily Summary</span>
        <h1 class="route-placeholder__heading">Digest</h1>
        <p class="route-placeholder__subtext">Your curated daily briefing — top matched roles delivered at 9AM.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>
        <div class="empty-state">
          <div class="empty-state__icon" aria-hidden="true">&#9728;</div>
          <p class="empty-state__title">No digest yet.</p>
          <p class="empty-state__body">Your first digest will be generated once your preferences are saved and jobs are tracked.</p>
        </div>
      </div>
    </div>

    <!-- ── Route: /settings ──────────────────── -->
    <div class="route-view" data-view="/settings" id="view-settings" role="main" aria-label="Settings">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">Configuration</span>
        <h1 class="route-placeholder__heading">Settings</h1>
        <p class="route-placeholder__subtext">Set your job preferences so we can match and deliver only the roles that matter to you.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>

        <form class="settings-form" onsubmit="return false;" aria-label="Job preferences form">

          <!-- Role Keywords -->
          <div class="settings-form__group">
            <label class="settings-form__label label" for="field-keywords">Role Keywords</label>
            <input
              id="field-keywords"
              type="text"
              class="input settings-form__input"
              placeholder="e.g. Frontend Developer, React, Node.js"
              disabled
              aria-describedby="hint-keywords"
            />
            <span id="hint-keywords" class="settings-form__hint">Separate multiple keywords with commas. Logic will be added in the next step.</span>
          </div>

          <!-- Preferred Locations -->
          <div class="settings-form__group">
            <label class="settings-form__label label" for="field-locations">Preferred Locations</label>
            <input
              id="field-locations"
              type="text"
              class="input settings-form__input"
              placeholder="e.g. Bangalore, Hyderabad, Remote"
              disabled
              aria-describedby="hint-locations"
            />
            <span id="hint-locations" class="settings-form__hint">Enter cities or regions where you're open to work.</span>
          </div>

          <!-- Work Mode -->
          <div class="settings-form__group">
            <label class="settings-form__label label" for="field-mode">Work Mode</label>
            <select id="field-mode" class="select settings-form__input" disabled aria-describedby="hint-mode">
              <option value="" disabled selected>Select a mode</option>
              <option value="remote">Remote</option>
              <option value="hybrid">Hybrid</option>
              <option value="onsite">Onsite</option>
            </select>
            <span id="hint-mode" class="settings-form__hint">Choose your preferred working arrangement.</span>
          </div>

          <!-- Experience Level -->
          <div class="settings-form__group">
            <label class="settings-form__label label" for="field-experience">Experience Level</label>
            <select id="field-experience" class="select settings-form__input" disabled aria-describedby="hint-experience">
              <option value="" disabled selected>Select a level</option>
              <option value="entry">Entry Level (0–1 years)</option>
              <option value="junior">Junior (1–2 years)</option>
              <option value="mid">Mid Level (2–4 years)</option>
              <option value="senior">Senior (4+ years)</option>
            </select>
            <span id="hint-experience" class="settings-form__hint">We use this to filter roles matched to your stage.</span>
          </div>

          <div class="settings-form__footer">
            <button type="submit" class="btn btn--primary" disabled>Save Preferences</button>
            <span class="settings-form__footer-note label text-muted">Logic will be connected in the next step.</span>
          </div>

        </form>
      </div>
    </div>

    <!-- ── Route: /proof ─────────────────────── -->
    <div class="route-view" data-view="/proof" id="view-proof" role="main" aria-label="Proof">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">Verification</span>
        <h1 class="route-placeholder__heading">Proof</h1>
        <p class="route-placeholder__subtext">Artifact collection — evidence that every notification was delivered, seen, and acted upon.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>
        <div class="empty-state">
          <div class="empty-state__icon" aria-hidden="true">&#10003;</div>
          <p class="empty-state__title">No artifacts yet.</p>
          <p class="empty-state__body">Proof logs, delivery receipts, and action confirmations will be collected here once the system is live.</p>
        </div>
      </div>
    </div>

    <!-- ── Route: /404 (Page Not Found) ────────── -->
    <div class="route-view" data-view="/404" id="view-404" role="main" aria-label="Page not found">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">404</span>
        <h1 class="route-placeholder__heading">Page Not Found</h1>
        <p class="route-placeholder__subtext">
          The page you're looking for doesn't exist. Check the URL or use the navigation above.
        </p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>
        <div class="route-placeholder__region">
          <span class="route-placeholder__region-label">Nothing here</span>
          <p class="route-placeholder__region-note">
            Try navigating to Dashboard, Saved, Digest, Settings, or Proof.
          </p>
          <a href="#/" style="margin-top: var(--space-2); font-family: var(--font-sans); font-size: var(--text-sm); color: var(--color-accent); text-decoration: underline;">← Back to Home</a>
        </div>
      </div>
    </div>

  </div><!-- /.app-body -->


  <!-- ══════════════════════════════════════════════
       JOB DETAIL MODAL
  ══════════════════════════════════════════════ -->
  <div class="modal-overlay" id="job-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal">
      <div class="modal__header">
        <div class="modal__header-titles">
          <h2 class="modal__title" id="modal-title"></h2>
          <span class="modal__company" id="modal-company"></span>
        </div>
        <button class="modal__close" id="modal-close" aria-label="Close job detail">&times;</button>
      </div>
      <div class="modal__body">
        <div class="modal__meta-grid" id="modal-meta"></div>
        <div>
          <p class="modal__section-label">About this role</p>
          <p class="modal__description" id="modal-description"></p>
        </div>
        <div>
          <p class="modal__section-label">Skills required</p>
          <div class="modal__skills" id="modal-skills"></div>
        </div>
      </div>
      <div class="modal__footer">
        <button class="btn job-card__btn" id="modal-save-btn">Save</button>
        <a class="btn btn--primary" id="modal-apply-btn" target="_blank" rel="noopener noreferrer">Apply Now ↗</a>
      </div>
    </div>
  </div>


  <!-- ══════════════════════════════════════════════
       HASH ROUTER
       No libraries. No dependencies.
       Reads window.location.hash → shows matching
       route-view, marks matching nav links is-active.
  ══════════════════════════════════════════════ -->
  <script>
    (() => {
      'use strict';

      // ── Route registry ────────────────────────────────
      // key   : hash path   (what appears after "#")
      // title : <title> tag value
      const routes = {
        '/':          { title: 'Home — Job Notification Tracker' },
        '/dashboard': { title: 'Dashboard — Job Notification Tracker' },
        '/saved':     { title: 'Saved Jobs — Job Notification Tracker' },
        '/digest':    { title: 'Digest — Job Notification Tracker' },
        '/settings':  { title: 'Settings — Job Notification Tracker' },
        '/proof':     { title: 'Proof — Job Notification Tracker' },
        '/404':       { title: 'Page Not Found — Job Notification Tracker' },
      };

      const defaultRoute = '/';

      // ── DOM refs ──────────────────────────────────────
      const allViews        = document.querySelectorAll('.route-view');
      const desktopLinks    = document.querySelectorAll('#desktop-nav .app-nav__link');
      const mobileLinks     = document.querySelectorAll('.app-nav__mobile-link');
      const hamburgerBtn    = document.getElementById('hamburger-btn');
      const mobileMenu      = document.getElementById('mobile-menu');

      // ── Parse current hash → route path ──────────────
      function getPath() {
        const hash = window.location.hash; // e.g. "#/dashboard"
        if (!hash || hash === '#') return defaultRoute;
        const path = hash.startsWith('#') ? hash.slice(1) : hash;
        // Unknown path → show 404, never a blank screen
        return routes[path] ? path : '/404';
      }

      // ── Activate a route ──────────────────────────────
      function navigate(path) {
        const route = routes[path];
        if (!route) return;

        // 1. Update page title
        document.title = route.title;

        // 2. Show matching view, hide all others
        allViews.forEach(view => {
          const isActive = view.dataset.view === path;
          view.classList.toggle('is-active', isActive);
        });

        // 3. Mark active desktop nav link
        desktopLinks.forEach(li => {
          const isActive = li.dataset.route === path;
          li.classList.toggle('is-active', isActive);
          const anchor = li.querySelector('a');
          if (anchor) anchor.setAttribute('aria-current', isActive ? 'page' : 'false');
        });

        // 4. Mark active mobile nav link
        mobileLinks.forEach(li => {
          const isActive = li.dataset.route === path;
          li.classList.toggle('is-active', isActive);
          const anchor = li.querySelector('a');
          if (anchor) anchor.setAttribute('aria-current', isActive ? 'page' : 'false');
        });

        // 5. Close mobile menu on navigate
        closeMobileMenu();
      }

      // ── Mobile menu toggle ────────────────────────────
      function closeMobileMenu() {
        mobileMenu.classList.remove('is-open');
        hamburgerBtn.setAttribute('aria-expanded', 'false');
        mobileMenu.setAttribute('aria-hidden', 'true');
      }

      function toggleMobileMenu() {
        const isOpen = mobileMenu.classList.contains('is-open');
        if (isOpen) {
          closeMobileMenu();
        } else {
          mobileMenu.classList.add('is-open');
          hamburgerBtn.setAttribute('aria-expanded', 'true');
          mobileMenu.setAttribute('aria-hidden', 'false');
        }
      }

      hamburgerBtn.addEventListener('click', toggleMobileMenu);

      // Close mobile menu on Escape key
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeMobileMenu();
      });

      // Close mobile menu when clicking outside the nav
      document.addEventListener('click', e => {
        const nav = document.querySelector('.app-nav');
        if (
          mobileMenu.classList.contains('is-open') &&
          !nav.contains(e.target) &&
          !mobileMenu.contains(e.target)
        ) {
          closeMobileMenu();
        }
      });

      // ── Hash change listener ──────────────────────────
      window.addEventListener('hashchange', () => navigate(getPath()));

      // ── Initial load ──────────────────────────────────
      // If arriving with no hash, default to home without
      // replacing browser history.
      if (!window.location.hash || window.location.hash === '#') {
        window.location.replace('#/');
      }
      navigate(getPath());

    })();
  </script>


  <!-- ══════════════════════════════════════════════
       PHASE 4 — JOB RENDERING ENGINE
       Reads window.JOBS, handles filter, save, modal.
       No framework. No dependencies.
  ══════════════════════════════════════════════ -->
  <script>
    (() => {
      'use strict';

      const STORAGE_KEY = 'jnt_saved_jobs';

      // ── Saved jobs (Set of ids, persisted to localStorage) ────
      function getSaved() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          return new Set(raw ? JSON.parse(raw) : []);
        } catch { return new Set(); }
      }

      function setSaved(set) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify([...set]));
      }

      let saved = getSaved();

      // ── Helpers ────────────────────────────────────────────────
      function postedLabel(days) {
        if (days === 0) return 'Posted today';
        if (days === 1) return '1 day ago';
        return `${days} days ago`;
      }

      function modeClass(mode) {
        return 'job-card__mode--' + mode.toLowerCase();
      }

      function esc(str) {
        const d = document.createElement('div');
        d.textContent = str;
        return d.innerHTML;
      }

      // ── Build a single job card HTML string ────────────────────
      function buildCard(job) {
        const isSaved = saved.has(job.id);
        return `
          <article class="job-card" role="listitem" data-id="${job.id}">
            <div class="job-card__header">
              <div class="job-card__titles">
                <span class="job-card__title">${esc(job.title)}</span>
                <span class="job-card__company">${esc(job.company)}</span>
              </div>
              <span class="job-card__source">${esc(job.source)}</span>
            </div>
            <div class="job-card__meta">
              <span class="job-card__meta-item">${esc(job.location)}</span>
              <span class="job-card__meta-item">${esc(job.experience)}</span>
              <span class="job-card__mode ${modeClass(job.mode)}">${esc(job.mode)}</span>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <span class="job-card__salary">${esc(job.salaryRange)}</span>
              <span class="job-card__posted">${postedLabel(job.postedDaysAgo)}</span>
            </div>
            <div class="job-card__footer">
              <button class="job-card__btn job-card__btn--view" data-id="${job.id}" aria-label="View details for ${esc(job.title)}">View</button>
              <button class="job-card__btn job-card__btn--save ${isSaved ? 'is-saved' : ''}" data-id="${job.id}" aria-label="${isSaved ? 'Unsave' : 'Save'} ${esc(job.title)}" aria-pressed="${isSaved}">
                ${isSaved ? '&#9829; Saved' : '&#9825; Save'}
              </button>
              <a class="job-card__btn job-card__btn--apply" href="${esc(job.applyUrl)}" target="_blank" rel="noopener noreferrer" aria-label="Apply for ${esc(job.title)}">Apply &#8599;</a>
            </div>
          </article>
        `;
      }

      // ── Render dashboard grid ──────────────────────────────────
      function renderDashboard(jobs) {
        const grid  = document.getElementById('job-grid');
        const empty = document.getElementById('dashboard-empty');
        const count = document.getElementById('filter-count');
        if (!grid) return;
        if (jobs.length === 0) {
          grid.innerHTML = '';
          grid.style.display = 'none';
          empty.style.display = '';
          count.textContent = '0 jobs';
        } else {
          grid.innerHTML = jobs.map(buildCard).join('');
          grid.style.display = '';
          empty.style.display = 'none';
          count.textContent = `${jobs.length} job${jobs.length !== 1 ? 's' : ''}`;
        }
      }

      // ── Render saved page ──────────────────────────────────────
      function renderSaved() {
        const grid  = document.getElementById('saved-grid');
        const empty = document.getElementById('saved-empty');
        if (!grid) return;
        saved = getSaved();
        const savedJobs = (window.JOBS || []).filter(j => saved.has(j.id));
        if (savedJobs.length === 0) {
          grid.innerHTML = '';
          grid.style.display = 'none';
          empty.style.display = '';
        } else {
          grid.innerHTML = savedJobs.map(buildCard).join('');
          grid.style.display = '';
          empty.style.display = 'none';
        }
      }

      // ── Filter logic ───────────────────────────────────────────
      function getFiltered() {
        const kw  = (document.getElementById('filter-keyword')?.value  || '').toLowerCase().trim();
        const loc = (document.getElementById('filter-location')?.value || '').toLowerCase();
        const mod = (document.getElementById('filter-mode')?.value     || '').toLowerCase();
        const exp = (document.getElementById('filter-experience')?.value|| '').toLowerCase();
        const src = (document.getElementById('filter-source')?.value   || '').toLowerCase();
        const srt = (document.getElementById('filter-sort')?.value     || 'latest');

        let jobs = (window.JOBS || []).filter(j => {
          if (kw  && !j.title.toLowerCase().includes(kw)  && !j.company.toLowerCase().includes(kw))  return false;
          if (loc && j.location.toLowerCase()  !== loc)   return false;
          if (mod && j.mode.toLowerCase()       !== mod)   return false;
          if (exp && j.experience.toLowerCase() !== exp)   return false;
          if (src && j.source.toLowerCase()     !== src)   return false;
          return true;
        });

        if (srt === 'latest')  jobs = jobs.sort((a, b) => a.postedDaysAgo - b.postedDaysAgo);
        if (srt === 'oldest')  jobs = jobs.sort((a, b) => b.postedDaysAgo - a.postedDaysAgo);
        if (srt === 'az')      jobs = jobs.sort((a, b) => a.company.localeCompare(b.company));

        return jobs;
      }

      function applyFilters() {
        renderDashboard(getFiltered());
        // Refresh save states after re-render
        updateAllSaveButtons();
      }

      // ── Update all save button states (after toggle) ───────────
      function updateAllSaveButtons() {
        document.querySelectorAll('.job-card__btn--save').forEach(btn => {
          const id = parseInt(btn.dataset.id, 10);
          const is = saved.has(id);
          btn.classList.toggle('is-saved', is);
          btn.setAttribute('aria-pressed', is);
          btn.innerHTML = is ? '&#9829; Saved' : '&#9825; Save';
        });
      }

      // ── Toggle save ────────────────────────────────────────────
      function toggleSave(id) {
        saved = getSaved();
        if (saved.has(id)) {
          saved.delete(id);
        } else {
          saved.add(id);
        }
        setSaved(saved);
        updateAllSaveButtons();
        // If on saved page, re-render it
        const savedView = document.getElementById('view-saved');
        if (savedView && savedView.classList.contains('is-active')) {
          renderSaved();
        }
        // Update modal save button if open for same job
        const modal = document.getElementById('job-modal');
        const modalSaveBtn = document.getElementById('modal-save-btn');
        if (modal && modal.classList.contains('is-open') && modalSaveBtn) {
          const modalId = parseInt(modal.dataset.jobId, 10);
          if (modalId === id) {
            const isSaved = saved.has(id);
            modalSaveBtn.textContent = isSaved ? '♥ Saved' : '♡ Save';
            modalSaveBtn.classList.toggle('is-saved', isSaved);
          }
        }
      }

      // ── Modal ──────────────────────────────────────────────────
      function openModal(id) {
        const job = (window.JOBS || []).find(j => j.id === id);
        if (!job) return;

        const modal = document.getElementById('job-modal');
        document.getElementById('modal-title').textContent   = job.title;
        document.getElementById('modal-company').textContent = job.company;
        document.getElementById('modal-description').textContent = job.description;

        // Meta grid
        document.getElementById('modal-meta').innerHTML = `
          <div class="modal__meta-item"><span class="modal__meta-label">Location</span><span class="modal__meta-value">${esc(job.location)}</span></div>
          <div class="modal__meta-item"><span class="modal__meta-label">Mode</span><span class="modal__meta-value">${esc(job.mode)}</span></div>
          <div class="modal__meta-item"><span class="modal__meta-label">Experience</span><span class="modal__meta-value">${esc(job.experience)}</span></div>
          <div class="modal__meta-item"><span class="modal__meta-label">Salary</span><span class="modal__meta-value">${esc(job.salaryRange)}</span></div>
          <div class="modal__meta-item"><span class="modal__meta-label">Source</span><span class="modal__meta-value">${esc(job.source)}</span></div>
          <div class="modal__meta-item"><span class="modal__meta-label">Posted</span><span class="modal__meta-value">${postedLabel(job.postedDaysAgo)}</span></div>
        `;

        // Skills
        document.getElementById('modal-skills').innerHTML =
          job.skills.map(s => `<span class="modal__skill-tag">${esc(s)}</span>`).join('');

        // Footer buttons
        const isSaved = saved.has(id);
        const saveBtn  = document.getElementById('modal-save-btn');
        const applyBtn = document.getElementById('modal-apply-btn');
        saveBtn.textContent = isSaved ? '♥ Saved' : '♡ Save';
        saveBtn.classList.toggle('is-saved', isSaved);
        saveBtn.dataset.id = id;
        applyBtn.href = job.applyUrl;

        modal.dataset.jobId = id;
        modal.classList.add('is-open');
        modal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
        document.getElementById('modal-close').focus();
      }

      function closeModal() {
        const modal = document.getElementById('job-modal');
        modal.classList.remove('is-open');
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }

      // ── Event delegation — dashboard + saved grids ─────────────
      document.addEventListener('click', e => {
        // View button
        const viewBtn = e.target.closest('.job-card__btn--view');
        if (viewBtn) { openModal(parseInt(viewBtn.dataset.id, 10)); return; }

        // Save button (card)
        const saveBtn = e.target.closest('.job-card__btn--save');
        if (saveBtn) { toggleSave(parseInt(saveBtn.dataset.id, 10)); return; }

        // Save button (modal)
        if (e.target.id === 'modal-save-btn') {
          toggleSave(parseInt(e.target.dataset.id, 10)); return;
        }

        // Close modal
        if (e.target.id === 'modal-close' || e.target.id === 'job-modal') {
          closeModal(); return;
        }
      });

      // Close modal on Escape
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
          const modal = document.getElementById('job-modal');
          if (modal && modal.classList.contains('is-open')) closeModal();
        }
      });

      // Filter inputs — live filtering
      ['filter-keyword','filter-location','filter-mode','filter-experience','filter-source','filter-sort'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', applyFilters);
      });

      // ── Integrate with router ──────────────────────────────────
      // Hook into the navigate function the router defines by
      // listening to hashchange and also on initial render.
      function onRouteChange(path) {
        if (path === '/dashboard') {
          // Small delay so route-view.is-active is already set
          setTimeout(() => renderDashboard(getFiltered()), 0);
        }
        if (path === '/saved') {
          setTimeout(() => renderSaved(), 0);
        }
      }

      window.addEventListener('hashchange', () => {
        const hash = window.location.hash || '#/';
        const path = hash.startsWith('#') ? hash.slice(1) : hash;
        onRouteChange(path);
      });

      // Initial route
      const initPath = (window.location.hash || '#/').slice(1) || '/';
      onRouteChange(initPath);

    })();
  </script>

</body>
</html>
