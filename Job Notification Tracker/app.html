<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Job Notification Tracker ‚Äî built on the KodNest Premium Build System." />
  <title>Job Notification Tracker</title>

  <!-- KodNest Design System (tokens ‚Üí base ‚Üí components ‚Üí layout ‚Üí states) -->
  <link rel="stylesheet" href="design-system/index.css" />
  <!-- App-level navigation and route shell styles -->
  <link rel="stylesheet" href="app.css" />
  <!-- Phase 4: 60-job dataset (assigns window.JOBS) -->
  <script src="data/jobs.js"></script>
</head>
<body>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TOP NAVIGATION BAR
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <nav class="app-nav" role="navigation" aria-label="Main navigation">
    <div class="app-nav__inner">

      <!-- Brand -->
      <a href="#/" class="app-nav__brand" aria-label="Job Notification Tracker home">
        <span class="app-nav__brand-dot" aria-hidden="true"></span>
        <span class="app-nav__brand-name">Job Notification Tracker</span>
      </a>

      <!-- Desktop links -->
      <ul class="app-nav__links" role="list" id="desktop-nav">
        <li class="app-nav__link" data-route="/dashboard">
          <a href="#/dashboard">Dashboard</a>
        </li>
        <li class="app-nav__link" data-route="/saved">
          <a href="#/saved">Saved</a>
        </li>
        <li class="app-nav__link" data-route="/digest">
          <a href="#/digest">Digest</a>
        </li>
        <li class="app-nav__link" data-route="/settings">
          <a href="#/settings">Settings</a>
        </li>
        <li class="app-nav__link" data-route="/proof">
          <a href="#/proof">Proof</a>
        </li>
        <li class="app-nav__link" data-route="/jt/07-test">
          <a href="#/jt/07-test">Test</a>
        </li>
        <li class="app-nav__link" data-route="/jt/08-ship">
          <a href="#/jt/08-ship">Ship</a>
        </li>
      </ul>

      <!-- Right slot (reserved for future: bell, avatar) -->
      <div class="app-nav__right" aria-hidden="true"></div>

      <!-- Hamburger (mobile) -->
      <button
        class="app-nav__hamburger"
        id="hamburger-btn"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span class="app-nav__hamburger-bar"></span>
        <span class="app-nav__hamburger-bar"></span>
        <span class="app-nav__hamburger-bar"></span>
      </button>

    </div>
  </nav>

  <!-- Mobile menu drawer (toggled by hamburger) -->
  <div class="app-nav__mobile-menu" id="mobile-menu" role="dialog" aria-label="Mobile navigation" aria-hidden="true">
    <ul class="app-nav__mobile-links" role="list">
      <li class="app-nav__mobile-link" data-route="/dashboard">
        <a href="#/dashboard">Dashboard</a>
      </li>
      <li class="app-nav__mobile-link" data-route="/saved">
        <a href="#/saved">Saved</a>
      </li>
      <li class="app-nav__mobile-link" data-route="/digest">
        <a href="#/digest">Digest</a>
      </li>
      <li class="app-nav__mobile-link" data-route="/settings">
        <a href="#/settings">Settings</a>
      </li>
      <li class="app-nav__mobile-link" data-route="/proof">
        <a href="#/proof">Proof</a>
      </li>
      <li class="app-nav__mobile-link" data-route="/jt/07-test">
        <a href="#/jt/07-test">Test</a>
      </li>
      <li class="app-nav__mobile-link" data-route="/jt/08-ship">
        <a href="#/jt/08-ship">Ship</a>
      </li>
    </ul>
  </div>


  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       APP BODY ‚Äî all route views rendered here
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="app-body">

    <!-- ‚îÄ‚îÄ Route: / (Home ‚Äî Landing Page) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="route-view" data-view="/" id="view-home" role="main" aria-label="Home">
      <div class="landing-hero">
        <span class="landing-hero__eyebrow label text-muted">Job Notification Tracker</span>
        <h1 class="landing-hero__heading">Stop Missing<br>The Right Jobs.</h1>
        <p class="landing-hero__subtext">Precision-matched job discovery delivered daily at 9AM.</p>
        <a href="#/settings" class="btn btn--primary landing-hero__cta">Start Tracking</a>
        <div class="landing-hero__proof">
          <span class="landing-hero__proof-dot" aria-hidden="true"></span>
          <span class="label text-muted">Built for students who are serious about landing the right role</span>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ Route: /dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="route-view" data-view="/dashboard" id="view-dashboard" role="main" aria-label="Dashboard">

      <!-- Page header -->
      <div class="route-placeholder" style="padding-bottom: 0;">
        <span class="route-placeholder__eyebrow label text-muted">Overview</span>
        <h1 class="route-placeholder__heading">Dashboard</h1>
        <p class="route-placeholder__subtext">60 real Indian tech opportunities ‚Äî match-scored against your preferences. Filter, save, and apply.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>
      </div>

      <!-- No-preferences banner (hidden when prefs are set) -->
      <div id="pref-banner" class="pref-banner" role="status" aria-live="polite" style="display:none;">
        <span class="pref-banner__icon" aria-hidden="true">&#9432;</span>
        <span class="pref-banner__text">Set your preferences to activate intelligent matching. <a href="#/settings" class="pref-banner__link">Go to Settings &rarr;</a></span>
      </div>

      <!-- Filter bar -->
      <div class="filter-bar" id="filter-bar" role="search" aria-label="Filter jobs">
        <div class="filter-bar__inner">
          <input
            id="filter-keyword"
            type="search"
            class="input filter-bar__search"
            placeholder="Search title or company‚Ä¶"
            aria-label="Search by title or company"
          />
          <select id="filter-location" class="select filter-bar__select" aria-label="Filter by location">
            <option value="">All Locations</option>
            <option>Bangalore</option>
            <option>Hyderabad</option>
            <option>Mumbai</option>
            <option>Pune</option>
            <option>Chennai</option>
            <option>Noida</option>
            <option>Remote</option>
          </select>
          <select id="filter-mode" class="select filter-bar__select" aria-label="Filter by work mode">
            <option value="">All Modes</option>
            <option>Remote</option>
            <option>Hybrid</option>
            <option>Onsite</option>
          </select>
          <select id="filter-experience" class="select filter-bar__select" aria-label="Filter by experience">
            <option value="">All Experience</option>
            <option>Fresher</option>
            <option>0-1</option>
            <option>1-3</option>
            <option>3-5</option>
          </select>
          <select id="filter-source" class="select filter-bar__select" aria-label="Filter by source">
            <option value="">All Sources</option>
            <option>LinkedIn</option>
            <option>Naukri</option>
            <option>Indeed</option>
          </select>
          <select id="filter-sort" class="select filter-bar__select" aria-label="Sort jobs">
            <option value="latest">Latest First</option>
            <option value="oldest">Oldest First</option>
            <option value="az">A &rarr; Z (Company)</option>
            <option value="score">Match Score &darr;</option>
            <option value="salary">Salary &darr;</option>
          </select>
          <select id="filter-status" class="select filter-bar__select" aria-label="Filter by application status">
            <option value="">All Statuses</option>
            <option value="Not Applied">Not Applied</option>
            <option value="Applied">Applied</option>
            <option value="Rejected">Rejected</option>
            <option value="Selected">Selected</option>
          </select>
          <span class="filter-bar__count" id="filter-count" aria-live="polite"></span>
          <button id="filter-clear-btn" class="btn filter-bar__clear" type="button" style="display:none;" aria-label="Clear all filters">&#10005; Clear All</button>
        </div>
        <!-- Match threshold toggle -->
        <div class="filter-bar__row2">
          <label class="match-toggle-label">
            <input type="checkbox" id="match-toggle" class="match-toggle__input" aria-label="Show only jobs above my threshold" />
            <span class="match-toggle__text">Show only jobs above my threshold</span>
          </label>
        </div>
      </div>

      <!-- Job grid -->
      <div class="job-grid-shell route-placeholder">
        <div id="job-grid" class="job-grid" role="list" aria-label="Job listings"></div>
        <div id="dashboard-empty" class="empty-state" style="display:none;">
          <div class="empty-state__icon" aria-hidden="true">&#9744;</div>
          <p class="empty-state__title">No roles match your criteria.</p>
          <p class="empty-state__body">Adjust your filters, lower your threshold, or <a href="#/settings" style="color:var(--color-accent);">update preferences</a>.</p>
        </div>
      </div>

    </div>

    <!-- ‚îÄ‚îÄ Route: /saved ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="route-view" data-view="/saved" id="view-saved" role="main" aria-label="Saved jobs">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">Bookmarks</span>
        <h1 class="route-placeholder__heading">Saved Jobs</h1>
        <p class="route-placeholder__subtext">Positions you've bookmarked for review and future application.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>
        <div id="saved-grid" class="job-grid" role="list" aria-label="Saved job listings"></div>
        <div id="saved-empty" class="empty-state">
          <div class="empty-state__icon" aria-hidden="true">&#9825;</div>
          <p class="empty-state__title">Nothing saved yet.</p>
          <p class="empty-state__body">Click ‚ÄúSave‚Äù on any job from the Dashboard to bookmark it here.</p>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ Route: /digest ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="route-view" data-view="/digest" id="view-digest" role="main" aria-label="Digest">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">Daily Summary</span>
        <h1 class="route-placeholder__heading">Digest</h1>
        <p class="route-placeholder__subtext">Your curated daily briefing &mdash; top matched roles delivered at 9AM.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>

        <!-- No-prefs blocker -->
        <div id="digest-no-prefs" class="empty-state" style="display:none;">
          <div class="empty-state__icon" aria-hidden="true">&#9432;</div>
          <p class="empty-state__title">Preferences required.</p>
          <p class="empty-state__body">Set preferences to generate a personalized digest. <a href="#/settings" style="color:var(--color-accent);">Go to Settings &rarr;</a></p>
        </div>

        <!-- Generate button area -->
        <div id="digest-generate-area" style="display:none;">
          <button class="btn btn--primary" id="digest-generate-btn">Generate Today&#39;s 9AM Digest (Simulated)</button>
          <p class="digest-sim-note">Demo Mode: Daily 9AM trigger simulated manually.</p>
        </div>

        <!-- Digest email card -->
        <div id="digest-card" class="digest-card" style="display:none;" aria-live="polite">
          <div class="digest-card__header">
            <p class="digest-card__eyebrow label">9AM DIGEST</p>
            <h2 class="digest-card__title">Top 10 Jobs For You</h2>
            <p class="digest-card__date" id="digest-date"></p>
          </div>
          <ol class="digest-list" id="digest-list"></ol>
          <div class="digest-card__footer">
            <p class="digest-card__footer-note">This digest was generated based on your preferences.</p>
          </div>
        </div>

        <!-- No matches state -->
        <div id="digest-no-matches" class="empty-state" style="display:none;">
          <div class="empty-state__icon" aria-hidden="true">&#9744;</div>
          <p class="empty-state__title">No matching roles today.</p>
          <p class="empty-state__body">No roles match your current preferences. Check again tomorrow or <a href="#/settings" style="color:var(--color-accent);">adjust preferences</a>.</p>
        </div>

        <!-- Action buttons -->
        <div id="digest-actions" class="digest-actions" style="display:none;">
          <button class="btn" id="digest-copy-btn">&#128203; Copy Digest to Clipboard</button>
          <a class="btn" id="digest-email-btn" href="#">&#9993; Create Email Draft</a>
        </div>

        <!-- Copy feedback -->
        <p id="digest-copy-msg" class="digest-copy-msg" style="display:none;" aria-live="polite">&#10003; Copied to clipboard!</p>

        <!-- Recent Status Updates (Phase 7) -->
        <div id="digest-status-section" class="digest-status-section" style="display:none;">
          <h3 class="digest-status__heading">Recent Status Updates</h3>
          <ul id="digest-status-list" class="digest-status-list"></ul>
        </div>

      </div>
    </div>

    <!-- ‚îÄ‚îÄ Route: /settings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="route-view" data-view="/settings" id="view-settings" role="main" aria-label="Settings">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">Configuration</span>
        <h1 class="route-placeholder__heading">Settings</h1>
        <p class="route-placeholder__subtext">Set your job preferences so we can match and deliver only the roles that matter to you.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>

        <form class="settings-form" id="prefs-form" aria-label="Job preferences form">

          <!-- Role Keywords -->
          <div class="settings-form__group">
            <label class="settings-form__label label" for="field-keywords">Role Keywords</label>
            <input
              id="field-keywords"
              type="text"
              class="input settings-form__input"
              placeholder="e.g. React Developer, Frontend, Node.js"
              aria-describedby="hint-keywords"
            />
            <span id="hint-keywords" class="settings-form__hint">Separate with commas. Matched against job title (+25) and description (+15).</span>
          </div>

          <!-- Preferred Locations -->
          <div class="settings-form__group">
            <label class="settings-form__label label" for="field-locations">Preferred Locations</label>
            <select id="field-locations" class="select settings-form__input" multiple size="4" aria-describedby="hint-locations">
              <option value="Bangalore">Bangalore</option>
              <option value="Hyderabad">Hyderabad</option>
              <option value="Mumbai">Mumbai</option>
              <option value="Pune">Pune</option>
              <option value="Chennai">Chennai</option>
              <option value="Noida">Noida</option>
              <option value="Remote">Remote</option>
            </select>
            <span id="hint-locations" class="settings-form__hint">Hold Ctrl / Cmd to select multiple cities. Matched against job location (+15).</span>
          </div>

          <!-- Work Mode -->
          <div class="settings-form__group">
            <span class="settings-form__label label" id="mode-group-label">Work Mode</span>
            <div class="settings-form__checkboxes" role="group" aria-labelledby="mode-group-label">
              <label class="settings-form__checkbox-label"><input type="checkbox" class="settings-form__checkbox" name="pref-mode" value="Remote" /> Remote</label>
              <label class="settings-form__checkbox-label"><input type="checkbox" class="settings-form__checkbox" name="pref-mode" value="Hybrid" /> Hybrid</label>
              <label class="settings-form__checkbox-label"><input type="checkbox" class="settings-form__checkbox" name="pref-mode" value="Onsite" /> Onsite</label>
            </div>
            <span class="settings-form__hint">Any checked mode earns +10 when matched.</span>
          </div>

          <!-- Experience Level -->
          <div class="settings-form__group">
            <label class="settings-form__label label" for="field-experience-pref">Experience Level</label>
            <select id="field-experience-pref" class="select settings-form__input" aria-describedby="hint-experience">
              <option value="">Any experience level</option>
              <option value="Fresher">Fresher (0 years)</option>
              <option value="0-1">0&ndash;1 Years</option>
              <option value="1-3">1&ndash;3 Years</option>
              <option value="3-5">3&ndash;5 Years</option>
            </select>
            <span id="hint-experience" class="settings-form__hint">Earns +10 when it matches the job's requirement exactly.</span>
          </div>

          <!-- Skills -->
          <div class="settings-form__group">
            <label class="settings-form__label label" for="field-skills">Your Skills</label>
            <input
              id="field-skills"
              type="text"
              class="input settings-form__input"
              placeholder="e.g. React, Python, SQL, AWS"
              aria-describedby="hint-skills"
            />
            <span id="hint-skills" class="settings-form__hint">Separate with commas. Any overlap with job skills earns +15.</span>
          </div>

          <!-- Minimum Match Score -->
          <div class="settings-form__group">
            <label class="settings-form__label label" for="field-minscore">
              Minimum Match Score &mdash; <strong id="minscore-display">40</strong>
            </label>
            <input
              id="field-minscore"
              type="range"
              class="settings-form__slider"
              min="0" max="100" step="5" value="40"
              aria-describedby="hint-minscore"
            />
            <span id="hint-minscore" class="settings-form__hint">Jobs below this score are hidden when the threshold toggle is enabled on Dashboard.</span>
          </div>

          <div class="settings-form__footer">
            <button type="submit" class="btn btn--primary" id="save-prefs-btn">Save Preferences</button>
            <button type="button" class="btn" id="clear-prefs-btn">Clear</button>
          </div>

          <div id="prefs-saved-msg" class="settings-form__saved-msg" style="display:none;" aria-live="polite">
            &#10003; Preferences saved. Head to <a href="#/dashboard">Dashboard</a> to see your matches.
          </div>

        </form>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ Route: /proof ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="route-view" data-view="/proof" id="view-proof" role="main" aria-label="Proof">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">Phase 9 &mdash; Final Submission</span>
        <h1 class="route-placeholder__heading">Proof</h1>
        <p class="route-placeholder__subtext">Artifact collection &mdash; links, completion status, and final submission export.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>

        <!-- Ship status badge -->
        <div class="proof-status-row">
          <span class="proof-status-label label text-muted">Project Status:</span>
          <span class="proof-badge" id="proof-badge">Not Started</span>
        </div>

        <!-- Step Completion Summary -->
        <section class="proof-section" aria-label="Step Completion Summary">
          <h2 class="proof-section__heading">Step Completion Summary</h2>
          <ul class="proof-steps" id="proof-steps" role="list"></ul>
        </section>

        <!-- Artifact Inputs -->
        <section class="proof-section" aria-label="Artifact Links">
          <h2 class="proof-section__heading">Artifact Links</h2>
          <p class="proof-section__desc">GitHub + Deployed required. Lovable is optional.</p>

          <div class="proof-field">
            <label class="proof-field__label label" for="proof-lovable">Lovable Project Link <span style="font-weight:400;color:var(--color-text-muted)">(optional)</span></label>
            <div class="proof-field__row">
              <input id="proof-lovable" type="url" class="input proof-field__input" placeholder="https://lovable.dev/..." autocomplete="off" />
              <button class="btn proof-field__save" data-proof-save="lovable">Save</button>
            </div>
            <span class="proof-field__error" id="proof-lovable-error" role="alert"></span>
            <span class="proof-field__saved" id="proof-lovable-saved"></span>
          </div>

          <div class="proof-field">
            <label class="proof-field__label label" for="proof-github">GitHub Repository Link</label>
            <div class="proof-field__row">
              <input id="proof-github" type="url" class="input proof-field__input" placeholder="https://github.com/..." autocomplete="off" />
              <button class="btn proof-field__save" data-proof-save="github">Save</button>
            </div>
            <span class="proof-field__error" id="proof-github-error" role="alert"></span>
            <span class="proof-field__saved" id="proof-github-saved"></span>
          </div>

          <div class="proof-field">
            <label class="proof-field__label label" for="proof-deployed">Deployed URL</label>
            <div class="proof-field__row">
              <input id="proof-deployed" type="url" class="input proof-field__input" placeholder="https://your-app.vercel.app" autocomplete="off" />
              <button class="btn proof-field__save" data-proof-save="deployed">Save</button>
            </div>
            <span class="proof-field__error" id="proof-deployed-error" role="alert"></span>
            <span class="proof-field__saved" id="proof-deployed-saved"></span>
          </div>
        </section>

        <!-- Final Submission -->
        <section class="proof-section" aria-label="Final Submission">
          <h2 class="proof-section__heading">Final Submission</h2>
          <div style="display:flex;gap:var(--space-2);flex-wrap:wrap;align-items:center;">
            <button class="btn btn--primary" id="proof-copy-btn" type="button">&#128203; Copy Final Submission</button>
            <span class="proof-copy-msg" id="proof-copy-msg" style="display:none;" aria-live="polite">&#10003; Copied!</span>
          </div>
          <pre class="proof-preview" id="proof-preview" aria-label="Submission preview"></pre>
        </section>

        <!-- Shipped message -->
        <div id="proof-shipped-msg" class="proof-shipped-msg" style="display:none;" aria-live="polite">
          Project 1 Shipped Successfully.
        </div>

      </div>
    </div>

    <!-- ‚îÄ‚îÄ Route: /jt/07-test (Test Checklist) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="route-view" data-view="/jt/07-test" id="view-test" role="main" aria-label="Test Checklist">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">Phase 8</span>
        <h1 class="route-placeholder__heading">Test Checklist</h1>
        <p class="route-placeholder__subtext">Verify every feature works before shipping.</p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>
        <div class="tc-summary">
          <p id="tc-score" class="tc-summary__score">Tests Passed: 0 / 10</p>
          <p id="tc-warn" class="tc-summary__warn">Complete all 10 tests before shipping.</p>
        </div>
        <ol id="tc-list" class="tc-list" role="list"></ol>
        <div style="margin-top:var(--space-4)">
          <button id="tc-reset-btn" class="btn" type="button">Reset All</button>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ Route: /jt/08-ship (Ship) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="route-view" data-view="/jt/08-ship" id="view-ship" role="main" aria-label="Ship">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">Phase 8</span>
        <div class="route-placeholder__divider" aria-hidden="true"></div>
        <!-- Locked state: not all tests passed -->
        <div id="ship-locked" class="ship-locked">
          <div class="ship-locked__icon" aria-hidden="true">üîí</div>
          <h1 class="ship-locked__title">Ship</h1>
          <p class="ship-locked__body">Complete all 10 tests to unlock ship.</p>
          <div class="ship-locked__progress-wrap">
            <div id="ship-progress-bar" class="ship-locked__progress-bar" style="width:0%"></div>
          </div>
          <p id="ship-progress-label" class="ship-locked__progress-label">0 / 10 tests passed</p>
          <a href="#/jt/07-test" class="btn btn--primary" style="margin-top:var(--space-4)">Go to Test Checklist ‚Üí</a>
        </div>
        <!-- Unlocked state: all 10 tests passed -->
        <div id="ship-unlocked" class="ship-unlocked" style="display:none;">
          <div class="ship-unlocked__icon" aria-hidden="true">üöÄ</div>
          <h1 class="ship-unlocked__title">Ready to Ship!</h1>
          <p class="ship-unlocked__body">All 10 tests passed. Your project is ready.</p>
          <a href="#/proof" class="btn btn--primary" style="margin-top:var(--space-4)">View Proof of Completion ‚Üí</a>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ Route: /404 (Page Not Found) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="route-view" data-view="/404" id="view-404" role="main" aria-label="Page not found">
      <div class="route-placeholder">
        <span class="route-placeholder__eyebrow label text-muted">404</span>
        <h1 class="route-placeholder__heading">Page Not Found</h1>
        <p class="route-placeholder__subtext">
          The page you're looking for doesn't exist. Check the URL or use the navigation above.
        </p>
        <div class="route-placeholder__divider" aria-hidden="true"></div>
        <div class="route-placeholder__region">
          <span class="route-placeholder__region-label">Nothing here</span>
          <p class="route-placeholder__region-note">
            Try navigating to Dashboard, Saved, Digest, Settings, or Proof.
          </p>
          <a href="#/" style="margin-top: var(--space-2); font-family: var(--font-sans); font-size: var(--text-sm); color: var(--color-accent); text-decoration: underline;">‚Üê Back to Home</a>
        </div>
      </div>
    </div>

  </div><!-- /.app-body -->


  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       JOB DETAIL MODAL
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="modal-overlay" id="job-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal">
      <div class="modal__header">
        <div class="modal__header-titles">
          <h2 class="modal__title" id="modal-title"></h2>
          <span class="modal__company" id="modal-company"></span>
        </div>
        <button class="modal__close" id="modal-close" aria-label="Close job detail">&times;</button>
      </div>
      <div class="modal__body">
        <div class="modal__meta-grid" id="modal-meta"></div>
        <div>
          <p class="modal__section-label">About this role</p>
          <p class="modal__description" id="modal-description"></p>
        </div>
        <div>
          <p class="modal__section-label">Skills required</p>
          <div class="modal__skills" id="modal-skills"></div>
        </div>
      </div>
      <div class="modal__footer">
        <button class="btn job-card__btn" id="modal-save-btn">Save</button>
        <a class="btn btn--primary" id="modal-apply-btn" target="_blank" rel="noopener noreferrer">Apply Now ‚Üó</a>
      </div>
    </div>
  </div>


  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       HASH ROUTER
       No libraries. No dependencies.
       Reads window.location.hash ‚Üí shows matching
       route-view, marks matching nav links is-active.
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
    (() => {
      'use strict';

      // ‚îÄ‚îÄ Route registry ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      // key   : hash path   (what appears after "#")
      // title : <title> tag value
      const routes = {
        '/':              { title: 'Home ‚Äî Job Notification Tracker' },
        '/dashboard':     { title: 'Dashboard ‚Äî Job Notification Tracker' },
        '/saved':         { title: 'Saved Jobs ‚Äî Job Notification Tracker' },
        '/digest':        { title: 'Digest ‚Äî Job Notification Tracker' },
        '/settings':      { title: 'Settings ‚Äî Job Notification Tracker' },
        '/proof':         { title: 'Proof ‚Äî Job Notification Tracker' },
        '/jt/07-test':    { title: 'Test Checklist ‚Äî Job Notification Tracker' },
        '/jt/08-ship':    { title: 'Ship ‚Äî Job Notification Tracker' },
        '/404':           { title: 'Page Not Found ‚Äî Job Notification Tracker' },
      };

      const defaultRoute = '/';

      // ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const allViews        = document.querySelectorAll('.route-view');
      const desktopLinks    = document.querySelectorAll('#desktop-nav .app-nav__link');
      const mobileLinks     = document.querySelectorAll('.app-nav__mobile-link');
      const hamburgerBtn    = document.getElementById('hamburger-btn');
      const mobileMenu      = document.getElementById('mobile-menu');

      // ‚îÄ‚îÄ Parse current hash ‚Üí route path ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function getPath() {
        const hash = window.location.hash; // e.g. "#/dashboard"
        if (!hash || hash === '#') return defaultRoute;
        const path = hash.startsWith('#') ? hash.slice(1) : hash;
        // Unknown path ‚Üí show 404, never a blank screen
        return routes[path] ? path : '/404';
      }

      // ‚îÄ‚îÄ Activate a route ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function navigate(path) {
        const route = routes[path];
        if (!route) return;

        // 1. Update page title
        document.title = route.title;

        // 2. Show matching view, hide all others
        allViews.forEach(view => {
          const isActive = view.dataset.view === path;
          view.classList.toggle('is-active', isActive);
        });

        // 3. Mark active desktop nav link
        desktopLinks.forEach(li => {
          const isActive = li.dataset.route === path;
          li.classList.toggle('is-active', isActive);
          const anchor = li.querySelector('a');
          if (anchor) anchor.setAttribute('aria-current', isActive ? 'page' : 'false');
        });

        // 4. Mark active mobile nav link
        mobileLinks.forEach(li => {
          const isActive = li.dataset.route === path;
          li.classList.toggle('is-active', isActive);
          const anchor = li.querySelector('a');
          if (anchor) anchor.setAttribute('aria-current', isActive ? 'page' : 'false');
        });

        // 5. Close mobile menu on navigate
        closeMobileMenu();
      }

      // ‚îÄ‚îÄ Mobile menu toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function closeMobileMenu() {
        mobileMenu.classList.remove('is-open');
        hamburgerBtn.setAttribute('aria-expanded', 'false');
        mobileMenu.setAttribute('aria-hidden', 'true');
      }

      function toggleMobileMenu() {
        const isOpen = mobileMenu.classList.contains('is-open');
        if (isOpen) {
          closeMobileMenu();
        } else {
          mobileMenu.classList.add('is-open');
          hamburgerBtn.setAttribute('aria-expanded', 'true');
          mobileMenu.setAttribute('aria-hidden', 'false');
        }
      }

      hamburgerBtn.addEventListener('click', toggleMobileMenu);

      // Close mobile menu on Escape key
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeMobileMenu();
      });

      // Close mobile menu when clicking outside the nav
      document.addEventListener('click', e => {
        const nav = document.querySelector('.app-nav');
        if (
          mobileMenu.classList.contains('is-open') &&
          !nav.contains(e.target) &&
          !mobileMenu.contains(e.target)
        ) {
          closeMobileMenu();
        }
      });

      // ‚îÄ‚îÄ Hash change listener ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      window.addEventListener('hashchange', () => navigate(getPath()));

      // ‚îÄ‚îÄ Initial load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      // If arriving with no hash, default to home without
      // replacing browser history.
      if (!window.location.hash || window.location.hash === '#') {
        window.location.replace('#/');
      }
      navigate(getPath());

    })();
  </script>


  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PHASE 4 ‚Äî JOB RENDERING ENGINE
       Reads window.JOBS, handles filter, save, modal.
       No framework. No dependencies.
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
    (() => {
      'use strict';

      const STORAGE_KEY = 'jnt_saved_jobs';
      const STATUS_KEY  = 'jobTrackerStatus';

      // ‚îÄ‚îÄ Status tracking ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function getStatuses() {
        try {
          const raw = localStorage.getItem(STATUS_KEY);
          return raw ? JSON.parse(raw) : {};
        } catch { return {}; }
      }

      function setStatuses(obj) {
        localStorage.setItem(STATUS_KEY, JSON.stringify(obj));
      }

      let statuses = getStatuses();

      function getStatus(id) {
        const entry = statuses[id];
        return (entry && entry.status) ? entry.status : 'Not Applied';
      }

      function setStatus(id, newStatus) {
        statuses[id] = { status: newStatus, date: new Date().toISOString().slice(0, 10) };
        setStatuses(statuses);
      }

      // ‚îÄ‚îÄ Saved jobs (Set of ids, persisted to localStorage) ‚îÄ‚îÄ‚îÄ‚îÄ
      function getSaved() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          return new Set(raw ? JSON.parse(raw) : []);
        } catch { return new Set(); }
      }

      function setSaved(set) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify([...set]));
      }

      let saved = getSaved();

      // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function postedLabel(days) {
        if (days === 0) return 'Posted today';
        if (days === 1) return '1 day ago';
        return `${days} days ago`;
      }

      function modeClass(mode) {
        return 'job-card__mode--' + mode.toLowerCase();
      }

      function esc(str) {
        const d = document.createElement('div');
        d.textContent = str;
        return d.innerHTML;
      }

      // ‚îÄ‚îÄ Defensive field fallbacks ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function safe(val, fallback) {
        return (val !== undefined && val !== null && String(val).trim() !== '') ? val : fallback;
      }

      // ‚îÄ‚îÄ Build a single job card HTML string ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      // score: number (0-100) | null (no prefs set)
      function buildCard(job, score) {
        const isSaved      = saved.has(job.id);
        const currentStatus = getStatus(job.id);
        const title      = safe(job.title,      'Untitled Role');
        const company    = safe(job.company,    'Unknown Company');
        const location   = safe(job.location,   'Location not listed');
        const experience = safe(job.experience, 'Experience not listed');
        const mode       = safe(job.mode,       'Onsite');
        const salary     = safe(job.salaryRange,'Salary not disclosed');
        const source     = safe(job.source,     'Source unknown');
        const applyUrl   = safe(job.applyUrl,   '#');
        const posted     = (typeof job.postedDaysAgo === 'number') ? job.postedDaysAgo : null;

        // Match score badge
        let badgeHTML = '';
        if (score !== null && score !== undefined) {
          const badgeClass = score >= 80 ? 'match-badge--green'
                           : score >= 60 ? 'match-badge--amber'
                           : score >= 40 ? 'match-badge--neutral'
                           :               'match-badge--grey';
          badgeHTML = `<span class="match-badge ${badgeClass}" title="Match score: ${score}">${score}</span>`;
        }

        return `
          <article class="job-card" role="listitem" data-id="${job.id}">
            <div class="job-card__header">
              <div class="job-card__titles">
                <div style="display:flex;align-items:center;gap:var(--space-1);flex-wrap:wrap;">
                  <span class="job-card__title">${esc(title)}</span>
                  ${badgeHTML}
                </div>
                <span class="job-card__company">${esc(company)}</span>
              </div>
              <span class="job-card__source">${esc(source)}</span>
            </div>
            <div class="job-card__meta">
              <span class="job-card__meta-item">${esc(location)}</span>
              <span class="job-card__meta-item">${esc(experience)}</span>
              <span class="job-card__mode ${modeClass(mode)}">${esc(mode)}</span>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <span class="job-card__salary">${esc(salary)}</span>
              <span class="job-card__posted">${posted !== null ? postedLabel(posted) : 'Recently posted'}</span>
            </div>
            <div class="job-card__footer">
              <button class="job-card__btn job-card__btn--view" data-id="${job.id}" aria-label="View details for ${esc(title)}">View</button>
              <button class="job-card__btn job-card__btn--save ${isSaved ? 'is-saved' : ''}" data-id="${job.id}" aria-label="${isSaved ? 'Unsave' : 'Save'} ${esc(title)}" aria-pressed="${isSaved}">
                ${isSaved ? '&#9829; Saved' : '&#9825; Save'}
              </button>
              <a class="job-card__btn job-card__btn--apply" href="${esc(applyUrl)}" target="_blank" rel="noopener noreferrer" aria-label="Apply for ${esc(title)}">Apply &#8599;</a>
            </div>
            <div class="status-group" role="group" aria-label="Application status for ${esc(title)}">
              ${['Not Applied','Applied','Rejected','Selected'].map(s => {
                const isCur = s === currentStatus;
                const cls   = s === 'Applied'  ? 'status-btn--applied'
                            : s === 'Rejected' ? 'status-btn--rejected'
                            : s === 'Selected' ? 'status-btn--selected'
                            :                   'status-btn--not-applied';
                return `<button class="status-btn ${cls}${isCur ? ' is-current' : ''}" data-id="${job.id}" data-status="${s}" aria-pressed="${isCur}">${s}</button>`;
              }).join('')}
            </div>
          </article>
        `;
      }

      // ‚îÄ‚îÄ Render dashboard grid ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      // scoredJobs: [{job, score}]  score = number | null
      function renderDashboard(scoredJobs) {
        const grid  = document.getElementById('job-grid');
        const empty = document.getElementById('dashboard-empty');
        const count = document.getElementById('filter-count');
        if (!grid) return;
        if (scoredJobs.length === 0) {
          grid.innerHTML = '';
          grid.style.display = 'none';
          empty.style.display = '';
          count.textContent = '0 jobs';
        } else {
          grid.innerHTML = scoredJobs.map(s => buildCard(s.job, s.score)).join('');
          grid.style.display = '';
          empty.style.display = 'none';
          count.textContent = `${scoredJobs.length} job${scoredJobs.length !== 1 ? 's' : ''}`;
        }
      }

      // ‚îÄ‚îÄ Render saved page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderSaved() {
        const grid  = document.getElementById('saved-grid');
        const empty = document.getElementById('saved-empty');
        if (!grid) return;
        saved    = getSaved();
        statuses = getStatuses();
        const savedJobs = (window.JOBS || []).filter(j => saved.has(j.id));
        if (savedJobs.length === 0) {
          grid.innerHTML = '';
          grid.style.display = 'none';
          empty.style.display = '';
        } else {
          grid.innerHTML = savedJobs.map(j => buildCard(j, null)).join('');
          grid.style.display = '';
          empty.style.display = 'none';
        }
      }

      // ‚îÄ‚îÄ Filter logic ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function getFiltered() {
        const kw  = (document.getElementById('filter-keyword')?.value  || '').toLowerCase().trim();
        const loc = (document.getElementById('filter-location')?.value || '').toLowerCase();
        const mod = (document.getElementById('filter-mode')?.value     || '').toLowerCase();
        const exp = (document.getElementById('filter-experience')?.value|| '').toLowerCase();
        const src = (document.getElementById('filter-source')?.value   || '').toLowerCase();
        const srt = (document.getElementById('filter-sort')?.value     || 'latest');

        let jobs = (window.JOBS || []).filter(j => {
          if (kw  && !j.title.toLowerCase().includes(kw)  && !j.company.toLowerCase().includes(kw))  return false;
          if (loc && j.location.toLowerCase()  !== loc)   return false;
          if (mod && j.mode.toLowerCase()       !== mod)   return false;
          if (exp && j.experience.toLowerCase() !== exp)   return false;
          if (src && j.source.toLowerCase()     !== src)   return false;
          return true;
        });

        if (srt === 'latest')  jobs = jobs.sort((a, b) => a.postedDaysAgo - b.postedDaysAgo);
        if (srt === 'oldest')  jobs = jobs.sort((a, b) => b.postedDaysAgo - a.postedDaysAgo);
        if (srt === 'az')      jobs = jobs.sort((a, b) => a.company.localeCompare(b.company));

        return jobs;
      }

      function applyFilters() {
        const { scored, hasP } = getScoredFiltered();
        const banner = document.getElementById('pref-banner');
        if (banner) banner.style.display = hasP ? 'none' : '';
        renderDashboard(scored);
        updateAllSaveButtons();
        // Show/hide Clear All button based on whether any filter is active
        const anyActive = [
          document.getElementById('filter-keyword')?.value || '',
          document.getElementById('filter-location')?.value || '',
          document.getElementById('filter-mode')?.value || '',
          document.getElementById('filter-experience')?.value || '',
          document.getElementById('filter-source')?.value || '',
          document.getElementById('filter-status')?.value || ''
        ].some(v => v !== '') ||
          (document.getElementById('filter-sort')?.value || 'latest') !== 'latest' ||
          (document.getElementById('match-toggle')?.checked || false);
        const clearBtn = document.getElementById('filter-clear-btn');
        if (clearBtn) clearBtn.style.display = anyActive ? '' : 'none';
      }

      // ‚îÄ‚îÄ Update all save button states (after toggle) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function updateAllSaveButtons() {
        document.querySelectorAll('.job-card__btn--save').forEach(btn => {
          const id = parseInt(btn.dataset.id, 10);
          const is = saved.has(id);
          btn.classList.toggle('is-saved', is);
          btn.setAttribute('aria-pressed', is);
          btn.innerHTML = is ? '&#9829; Saved' : '&#9825; Save';
        });
      }

      // ‚îÄ‚îÄ Toast notification ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function showToast(message) {
        const toast = document.getElementById('status-toast');
        if (!toast) return;
        toast.textContent = message;
        toast.classList.add('is-visible');
        clearTimeout(toast._toastTimer);
        toast._toastTimer = setTimeout(() => toast.classList.remove('is-visible'), 3000);
      }

      // ‚îÄ‚îÄ Toggle save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function toggleSave(id) {
        saved = getSaved();
        if (saved.has(id)) {
          saved.delete(id);
        } else {
          saved.add(id);
        }
        setSaved(saved);
        updateAllSaveButtons();
        // If on saved page, re-render it
        const savedView = document.getElementById('view-saved');
        if (savedView && savedView.classList.contains('is-active')) {
          renderSaved();
        }
        // Update modal save button if open for same job
        const modal = document.getElementById('job-modal');
        const modalSaveBtn = document.getElementById('modal-save-btn');
        if (modal && modal.classList.contains('is-open') && modalSaveBtn) {
          const modalId = parseInt(modal.dataset.jobId, 10);
          if (modalId === id) {
            const isSaved = saved.has(id);
            modalSaveBtn.textContent = isSaved ? '‚ô• Saved' : '‚ô° Save';
            modalSaveBtn.classList.toggle('is-saved', isSaved);
          }
        }
      }

      // ‚îÄ‚îÄ Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function openModal(id) {
        const job = (window.JOBS || []).find(j => j.id === id);
        if (!job) return;

        const modal = document.getElementById('job-modal');
        document.getElementById('modal-title').textContent   = safe(job.title,      'Untitled Role');
        document.getElementById('modal-company').textContent = safe(job.company,    'Unknown Company');
        document.getElementById('modal-description').textContent = safe(job.description, 'No description available.');

        // Meta grid
        const posted = (typeof job.postedDaysAgo === 'number') ? postedLabel(job.postedDaysAgo) : 'Recently';
        document.getElementById('modal-meta').innerHTML = `
          <div class="modal__meta-item"><span class="modal__meta-label">Location</span><span class="modal__meta-value">${esc(safe(job.location,'Not listed'))}</span></div>
          <div class="modal__meta-item"><span class="modal__meta-label">Mode</span><span class="modal__meta-value">${esc(safe(job.mode,'Not listed'))}</span></div>
          <div class="modal__meta-item"><span class="modal__meta-label">Experience</span><span class="modal__meta-value">${esc(safe(job.experience,'Not listed'))}</span></div>
          <div class="modal__meta-item"><span class="modal__meta-label">Salary</span><span class="modal__meta-value">${esc(safe(job.salaryRange,'Salary not disclosed'))}</span></div>
          <div class="modal__meta-item"><span class="modal__meta-label">Source</span><span class="modal__meta-value">${esc(safe(job.source,'Unknown'))}</span></div>
          <div class="modal__meta-item"><span class="modal__meta-label">Posted</span><span class="modal__meta-value">${posted}</span></div>
        `;

        // Skills
        const skills = Array.isArray(job.skills) && job.skills.length ? job.skills : ['No skills listed'];
        document.getElementById('modal-skills').innerHTML =
          skills.map(s => `<span class="modal__skill-tag">${esc(s)}</span>`).join('');

        // Footer buttons
        const isSaved = saved.has(id);
        const saveBtn  = document.getElementById('modal-save-btn');
        const applyBtn = document.getElementById('modal-apply-btn');
        saveBtn.textContent = isSaved ? '‚ô• Saved' : '‚ô° Save';
        saveBtn.classList.toggle('is-saved', isSaved);
        saveBtn.dataset.id = id;
        applyBtn.href = job.applyUrl;

        modal.dataset.jobId = id;
        modal.classList.add('is-open');
        modal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
        document.getElementById('modal-close').focus();
      }

      function closeModal() {
        const modal = document.getElementById('job-modal');
        modal.classList.remove('is-open');
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // PHASE 5 ‚Äî PREFERENCES + MATCH SCORE ENGINE
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      const PREFS_KEY = 'jobTrackerPreferences';

      function getPrefs() {
        try { return JSON.parse(localStorage.getItem(PREFS_KEY) || 'null'); }
        catch { return null; }
      }

      function hasPrefs(prefs) {
        if (!prefs) return false;
        return (prefs.roleKeywords    && prefs.roleKeywords.length    > 0) ||
               (prefs.preferredLocations && prefs.preferredLocations.length > 0) ||
               (prefs.preferredMode  && prefs.preferredMode.length   > 0) ||
               !!prefs.experienceLevel ||
               (prefs.skills         && prefs.skills.length          > 0);
      }

      // Scoring rules (spec-exact):
      // +25 keyword in title, +15 keyword in description
      // +15 location match, +10 mode match, +10 experience match
      // +15 any skill overlap, +5 posted<=2, +5 LinkedIn. Cap 100.
      function computeMatchScore(job, prefs) {
        let score = 0;
        const kws = (prefs.roleKeywords || []).filter(Boolean);

        if (kws.some(kw => job.title.toLowerCase().includes(kw.toLowerCase())))
          score += 25;
        if (kws.some(kw => (job.description || '').toLowerCase().includes(kw.toLowerCase())))
          score += 15;

        const locs = (prefs.preferredLocations || []).map(l => l.toLowerCase());
        if (locs.length && locs.includes((job.location || '').toLowerCase()))
          score += 15;

        const modes = (prefs.preferredMode || []).map(m => m.toLowerCase());
        if (modes.length && modes.includes((job.mode || '').toLowerCase()))
          score += 10;

        if (prefs.experienceLevel &&
            (job.experience || '').toLowerCase() === prefs.experienceLevel.toLowerCase())
          score += 10;

        const uSkills = (prefs.skills || []).filter(Boolean).map(s => s.toLowerCase());
        const jSkills = (job.skills  || []).map(s => s.toLowerCase());
        if (uSkills.length &&
            uSkills.some(us => jSkills.some(js => js.includes(us) || us.includes(js))))
          score += 15;

        if (typeof job.postedDaysAgo === 'number' && job.postedDaysAgo <= 2)
          score += 5;
        if (job.source === 'LinkedIn')
          score += 5;

        return Math.min(score, 100);
      }

      function extractSalaryNum(range) {
        const m = String(range || '').match(/\d+/);
        return m ? parseInt(m[0], 10) : 0;
      }

      // Returns {scored:[{job,score}], prefs, hasP}
      function getScoredFiltered() {
        const prefs = getPrefs();
        const hasP  = hasPrefs(prefs);

        const kw  = (document.getElementById('filter-keyword')?.value   || '').toLowerCase().trim();
        const loc = (document.getElementById('filter-location')?.value  || '').toLowerCase();
        const mod = (document.getElementById('filter-mode')?.value      || '').toLowerCase();
        const exp = (document.getElementById('filter-experience')?.value || '').toLowerCase();
        const src = (document.getElementById('filter-source')?.value    || '').toLowerCase();
        const srt = (document.getElementById('filter-sort')?.value      || 'latest');
        const matchOnly  = document.getElementById('match-toggle')?.checked || false;
        const threshold  = hasP ? (prefs.minMatchScore ?? 40) : 0;
        const statusF    = document.getElementById('filter-status')?.value || '';

        statuses = getStatuses();   // refresh from localStorage

        let jobs = (window.JOBS || []).filter(j => {
          if (kw  && !j.title.toLowerCase().includes(kw) &&
                     !j.company.toLowerCase().includes(kw))           return false;
          if (loc && (j.location   || '').toLowerCase() !== loc)      return false;
          if (mod && (j.mode       || '').toLowerCase() !== mod)      return false;
          if (exp && (j.experience || '').toLowerCase() !== exp)      return false;
          if (src && (j.source     || '').toLowerCase() !== src)      return false;
          if (statusF && getStatus(j.id) !== statusF)                 return false;
          return true;
        });

        const scored = jobs.map(j => ({
          job:   j,
          score: hasP ? computeMatchScore(j, prefs) : null
        }));

        const visible = (matchOnly && hasP)
          ? scored.filter(s => s.score >= threshold)
          : scored;

        if      (srt === 'latest')  visible.sort((a, b) => a.job.postedDaysAgo - b.job.postedDaysAgo);
        else if (srt === 'oldest')  visible.sort((a, b) => b.job.postedDaysAgo - a.job.postedDaysAgo);
        else if (srt === 'az')      visible.sort((a, b) => a.job.company.localeCompare(b.job.company));
        else if (srt === 'score')   visible.sort((a, b) => (b.score || 0) - (a.score || 0));
        else if (srt === 'salary')  visible.sort((a, b) =>
          extractSalaryNum(b.job.salaryRange) - extractSalaryNum(a.job.salaryRange));

        return { scored: visible, prefs, hasP };
      }

      // ‚îÄ‚îÄ Settings: prefill from localStorage ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function prefillSettings() {
        const prefs = getPrefs();
        if (!prefs) return;

        const kwEl = document.getElementById('field-keywords');
        if (kwEl) kwEl.value = (prefs.roleKeywords || []).join(', ');

        const locEl = document.getElementById('field-locations');
        if (locEl) {
          Array.from(locEl.options).forEach(opt => {
            opt.selected = (prefs.preferredLocations || []).includes(opt.value);
          });
        }

        document.querySelectorAll('[name="pref-mode"]').forEach(cb => {
          cb.checked = (prefs.preferredMode || []).includes(cb.value);
        });

        const expEl = document.getElementById('field-experience-pref');
        if (expEl) expEl.value = prefs.experienceLevel || '';

        const skillEl = document.getElementById('field-skills');
        if (skillEl) skillEl.value = (prefs.skills || []).join(', ');

        const scoreEl      = document.getElementById('field-minscore');
        const scoreDisplay = document.getElementById('minscore-display');
        if (scoreEl) {
          scoreEl.value = prefs.minMatchScore ?? 40;
          if (scoreDisplay) scoreDisplay.textContent = scoreEl.value;
        }
      }

      // ‚îÄ‚îÄ Settings: read form ‚Üí build prefs object ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function readPrefsFromForm() {
        const kwRaw    = document.getElementById('field-keywords')?.value    || '';
        const skillRaw = document.getElementById('field-skills')?.value      || '';
        const locEl    = document.getElementById('field-locations');
        const expEl    = document.getElementById('field-experience-pref');
        const scoreEl  = document.getElementById('field-minscore');

        return {
          roleKeywords:       kwRaw.split(',').map(s => s.trim()).filter(Boolean),
          preferredLocations: locEl
            ? Array.from(locEl.selectedOptions).map(o => o.value)
            : [],
          preferredMode: Array.from(
            document.querySelectorAll('[name="pref-mode"]:checked')
          ).map(cb => cb.value),
          experienceLevel: expEl?.value || '',
          skills:          skillRaw.split(',').map(s => s.trim()).filter(Boolean),
          minMatchScore:   scoreEl ? parseInt(scoreEl.value, 10) : 40,
        };
      }

      // ‚îÄ‚îÄ Settings form: save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const prefsForm = document.getElementById('prefs-form');
      if (prefsForm) {
        prefsForm.addEventListener('submit', e => {
          e.preventDefault();
          const prefs = readPrefsFromForm();
          localStorage.setItem(PREFS_KEY, JSON.stringify(prefs));
          const msg = document.getElementById('prefs-saved-msg');
          if (msg) { msg.style.display = ''; setTimeout(() => { msg.style.display = 'none'; }, 4000); }
        });
      }

      // ‚îÄ‚îÄ Settings form: clear ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const clearPrefsBtn = document.getElementById('clear-prefs-btn');
      if (clearPrefsBtn) {
        clearPrefsBtn.addEventListener('click', () => {
          localStorage.removeItem(PREFS_KEY);
          if (prefsForm) prefsForm.reset();
          const sd = document.getElementById('minscore-display');
          if (sd) sd.textContent = '40';
          const msg = document.getElementById('prefs-saved-msg');
          if (msg) msg.style.display = 'none';
        });
      }

      // ‚îÄ‚îÄ Slider live display ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const scoreSlider = document.getElementById('field-minscore');
      if (scoreSlider) {
        scoreSlider.addEventListener('input', () => {
          const d = document.getElementById('minscore-display');
          if (d) d.textContent = scoreSlider.value;
        });
      }

      // ‚îÄ‚îÄ Match toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const matchToggleEl = document.getElementById('match-toggle');
      if (matchToggleEl) matchToggleEl.addEventListener('change', applyFilters);

      // ‚îÄ‚îÄ Event delegation ‚Äî dashboard + saved grids ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      document.addEventListener('click', e => {
        // Status button
        const statusBtn = e.target.closest('.status-btn');
        if (statusBtn) {
          const id = parseInt(statusBtn.dataset.id, 10);
          const st = statusBtn.dataset.status;
          setStatus(id, st);
          // Update all status buttons for this job in the DOM
          document.querySelectorAll(`.status-btn[data-id="${id}"]`).forEach(btn => {
            const isCur = btn.dataset.status === st;
            btn.classList.toggle('is-current', isCur);
            btn.setAttribute('aria-pressed', String(isCur));
          });
          // Show toast for non-default status
          if (st !== 'Not Applied') showToast(`Status updated: ${st}`);
          return;
        }

        // View button
        const viewBtn = e.target.closest('.job-card__btn--view');
        if (viewBtn) { openModal(parseInt(viewBtn.dataset.id, 10)); return; }

        // Save button (card)
        const saveBtn = e.target.closest('.job-card__btn--save');
        if (saveBtn) { toggleSave(parseInt(saveBtn.dataset.id, 10)); return; }

        // Save button (modal)
        if (e.target.id === 'modal-save-btn') {
          toggleSave(parseInt(e.target.dataset.id, 10)); return;
        }

        // Close modal
        if (e.target.id === 'modal-close' || e.target.id === 'job-modal') {
          closeModal(); return;
        }
      });

      // Close modal on Escape
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
          const modal = document.getElementById('job-modal');
          if (modal && modal.classList.contains('is-open')) closeModal();
        }
      });

      // ‚îÄ‚îÄ Clear All filters button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const filterClearBtn = document.getElementById('filter-clear-btn');
      if (filterClearBtn) {
        filterClearBtn.addEventListener('click', () => {
          const kw = document.getElementById('filter-keyword');
          if (kw) kw.value = '';
          ['filter-location','filter-mode','filter-experience','filter-source','filter-status'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = '';
          });
          const sortEl = document.getElementById('filter-sort');
          if (sortEl) sortEl.value = 'latest';
          const toggle = document.getElementById('match-toggle');
          if (toggle) toggle.checked = false;
          filterClearBtn.style.display = 'none';
          applyFilters();
        });
      }

      // Filter inputs ‚Äî live filtering
      // keyword uses 'input' for instant search; selects use 'change'
      ['filter-keyword','filter-location','filter-mode','filter-experience','filter-source','filter-sort','filter-status'].forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        const evt = el.tagName === 'INPUT' ? 'input' : 'change';
        el.addEventListener(evt, applyFilters);
      });

      // ‚îÄ‚îÄ Integrate with router ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      // Hook into the navigate function the router defines by
      // listening to hashchange and also on initial render.
      function onRouteChange(path) {
        if (path === '/dashboard') {
          setTimeout(() => applyFilters(), 0);
        }
        if (path === '/digest') {
          setTimeout(() => { if (window._renderDigest) window._renderDigest(); }, 50);
        }
        if (path === '/saved') {
          setTimeout(() => renderSaved(), 0);
        }
        if (path === '/settings') {
          setTimeout(() => prefillSettings(), 0);
        }
        if (path === '/jt/07-test') {
          setTimeout(() => { if (window._renderTest) window._renderTest(); }, 0);
        }
        if (path === '/jt/08-ship') {
          setTimeout(() => { if (window._renderShip) window._renderShip(); }, 0);
        }
        if (path === '/proof') {
          setTimeout(() => { if (window._renderProof) window._renderProof(); }, 0);
        }
      }

      window.addEventListener('hashchange', () => {
        const hash = window.location.hash || '#/';
        const path = hash.startsWith('#') ? hash.slice(1) : hash;
        onRouteChange(path);
      });

      // Initial route
      const initPath = (window.location.hash || '#/').slice(1) || '/';
      onRouteChange(initPath);

    })();
  </script>


  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PHASE 6 ‚Äî DIGEST ENGINE
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
    (() => {
      'use strict';

      // ‚îÄ‚îÄ Dependency: re-use prefs + scoring from Phase 5 scope ‚îÄ‚îÄ
      // We read directly from localStorage and re-implement the
      // minimal helpers we need (keeps scripts fully independent).

      const DIGEST_KEY_PREFIX = 'jobTrackerDigest_';
      const PREFS_KEY_D = 'jobTrackerPreferences';

      function todayKey() {
        return DIGEST_KEY_PREFIX + new Date().toISOString().slice(0, 10);
      }

      function todayLabel() {
        return new Date().toLocaleDateString('en-IN', {
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
      }

      function getPrefsD() {
        try { return JSON.parse(localStorage.getItem(PREFS_KEY_D) || 'null'); }
        catch { return null; }
      }

      function hasPrefsD(p) {
        if (!p) return false;
        return (p.roleKeywords    && p.roleKeywords.length    > 0) ||
               (p.preferredLocations && p.preferredLocations.length > 0) ||
               (p.preferredMode  && p.preferredMode.length   > 0) ||
               !!p.experienceLevel ||
               (p.skills         && p.skills.length          > 0);
      }

      // Same scoring logic as Phase 5 engine
      function scoreJob(job, p) {
        let s = 0;
        const kws = (p.roleKeywords || []).filter(Boolean);
        if (kws.some(k => job.title.toLowerCase().includes(k.toLowerCase())))       s += 25;
        if (kws.some(k => (job.description||'').toLowerCase().includes(k.toLowerCase()))) s += 15;
        const locs = (p.preferredLocations || []).map(l => l.toLowerCase());
        if (locs.length && locs.includes((job.location||'').toLowerCase()))         s += 15;
        const mods = (p.preferredMode || []).map(m => m.toLowerCase());
        if (mods.length && mods.includes((job.mode||'').toLowerCase()))             s += 10;
        if (p.experienceLevel && (job.experience||'').toLowerCase() === p.experienceLevel.toLowerCase()) s += 10;
        const uSk = (p.skills||[]).filter(Boolean).map(x => x.toLowerCase());
        const jSk = (job.skills||[]).map(x => x.toLowerCase());
        if (uSk.length && uSk.some(u => jSk.some(j => j.includes(u)||u.includes(j)))) s += 15;
        if (typeof job.postedDaysAgo === 'number' && job.postedDaysAgo <= 2)        s += 5;
        if (job.source === 'LinkedIn')                                               s += 5;
        return Math.min(s, 100);
      }

      function generateDigestJobs(prefs) {
        const scored = (window.JOBS || []).map(j => ({ job: j, score: scoreJob(j, prefs) }));
        scored.sort((a, b) => b.score - a.score || a.job.postedDaysAgo - b.job.postedDaysAgo);
        return scored.slice(0, 10);
      }

      // ‚îÄ‚îÄ Plain-text serialiser for clipboard / mailto ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function digestToText(items, dateStr) {
        const lines = [
          '=== 9AM Job Digest: Top 10 For You ===',
          dateStr,
          ''
        ];
        items.forEach((s, i) => {
          const j = s.job;
          lines.push(
            `${i + 1}. ${j.title} @ ${j.company}`,
            `   Location : ${j.location} (${j.mode})`,
            `   Experience: ${j.experience}`,
            `   Salary   : ${j.salaryRange}`,
            `   Match    : ${s.score}/100`,
            `   Apply    : ${j.applyUrl}`,
            ''
          );
        });
        lines.push('Generated by Job Notification Tracker based on your saved preferences.');
        return lines.join('\n');
      }

      // ‚îÄ‚îÄ Recent Status Updates section ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderRecentStatusUpdates() {
        const section = document.getElementById('digest-status-section');
        const list    = document.getElementById('digest-status-list');
        if (!section || !list) return;

        let statusData;
        try { statusData = JSON.parse(localStorage.getItem('jobTrackerStatus') || '{}'); }
        catch { statusData = {}; }

        const entries = Object.entries(statusData)
          .filter(([, v]) => v && v.status && v.status !== 'Not Applied')
          .map(([id, v]) => {
            const job = (window.JOBS || []).find(j => j.id === parseInt(id, 10));
            return job ? { job, status: v.status, date: v.date } : null;
          })
          .filter(Boolean)
          .sort((a, b) => (b.date || '').localeCompare(a.date || ''));

        if (entries.length === 0) { section.style.display = 'none'; return; }

        section.style.display = '';
        list.innerHTML = entries.map(({ job, status, date }) => {
          const cls = status === 'Applied'  ? 'digest-status-item__status--applied'
                    : status === 'Rejected' ? 'digest-status-item__status--rejected'
                    : status === 'Selected' ? 'digest-status-item__status--selected'
                    : '';
          return `
            <li class="digest-status-item">
              <div class="digest-status-item__info">
                <div class="digest-status-item__title">${job.title}</div>
                <div class="digest-status-item__company">${job.company}</div>
              </div>
              <span class="digest-status-item__status ${cls}">${status}</span>
              <span class="digest-status-item__date">${date || '‚Äî'}</span>
            </li>`;
        }).join('');
      }

      // ‚îÄ‚îÄ Render digest card into the DOM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function paintDigest(items, dateStr) {
        // Date
        const dateEl = document.getElementById('digest-date');
        if (dateEl) dateEl.textContent = dateStr;

        // List
        const list = document.getElementById('digest-list');
        if (!list) return;
        list.innerHTML = items.map((s, i) => {
          const j = s.job;
          const badgeClass = s.score >= 80 ? 'match-badge--green'
                           : s.score >= 60 ? 'match-badge--amber'
                           : s.score >= 40 ? 'match-badge--neutral'
                           :                 'match-badge--grey';
          return `
            <li class="digest-item">
              <div class="digest-item__rank">${i + 1}</div>
              <div class="digest-item__body">
                <div class="digest-item__top">
                  <span class="digest-item__title">${j.title}</span>
                  <span class="match-badge ${badgeClass}">${s.score}</span>
                </div>
                <span class="digest-item__company">${j.company} &middot; ${j.location} &middot; ${j.mode}</span>
                <span class="digest-item__meta">${j.experience} &middot; ${j.salaryRange}</span>
              </div>
              <a class="btn btn--primary digest-item__apply" href="${j.applyUrl}" target="_blank" rel="noopener noreferrer">Apply &nearr;</a>
            </li>`;
        }).join('');

        // Show card, hide others
        document.getElementById('digest-generate-area').style.display = 'none';
        document.getElementById('digest-card').style.display = '';
        document.getElementById('digest-no-matches').style.display = 'none';
        document.getElementById('digest-actions').style.display = '';
        document.getElementById('digest-no-prefs').style.display = 'none';

        // Wire action buttons
        const text = digestToText(items, dateStr);

        const copyBtn = document.getElementById('digest-copy-btn');
        if (copyBtn) {
          copyBtn.onclick = () => {
            navigator.clipboard.writeText(text).then(() => {
              const msg = document.getElementById('digest-copy-msg');
              if (msg) { msg.style.display = ''; setTimeout(() => { msg.style.display = 'none'; }, 3000); }
            }).catch(() => {
              // Fallback for browsers without clipboard API
              const ta = document.createElement('textarea');
              ta.value = text;
              ta.style.position = 'fixed';
              ta.style.opacity = '0';
              document.body.appendChild(ta);
              ta.select();
              document.execCommand('copy');
              document.body.removeChild(ta);
              const msg = document.getElementById('digest-copy-msg');
              if (msg) { msg.style.display = ''; setTimeout(() => { msg.style.display = 'none'; }, 3000); }
            });
          };
        }

        const emailBtn = document.getElementById('digest-email-btn');
        if (emailBtn) {
          const subject = encodeURIComponent('My 9AM Job Digest');
          const body    = encodeURIComponent(text);
          emailBtn.href = `mailto:?subject=${subject}&body=${body}`;
        }

        renderRecentStatusUpdates();
      }

      // ‚îÄ‚îÄ Main render function (called on route /digest) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderDigest() {
        const prefs = getPrefsD();

        if (!hasPrefsD(prefs)) {
          document.getElementById('digest-no-prefs').style.display = '';
          document.getElementById('digest-generate-area').style.display = 'none';
          document.getElementById('digest-card').style.display = 'none';
          document.getElementById('digest-no-matches').style.display = 'none';
          document.getElementById('digest-actions').style.display = 'none';
          renderRecentStatusUpdates();
          return;
        }

        // Reset visibility
        document.getElementById('digest-no-prefs').style.display = 'none';

        // Check if today's digest already exists in localStorage
        const key = todayKey();
        const existing = localStorage.getItem(key);
        if (existing) {
          try {
            const cached = JSON.parse(existing);
            if (cached.items && cached.items.length > 0) {
              paintDigest(cached.items, cached.dateStr);
              return;
            }
          } catch { /* fall through to regenerate */ }
        }

        // Show generate button, hide card
        document.getElementById('digest-generate-area').style.display = '';
        document.getElementById('digest-card').style.display = 'none';
        document.getElementById('digest-no-matches').style.display = 'none';
        document.getElementById('digest-actions').style.display = 'none';
        renderRecentStatusUpdates();
      }

      // ‚îÄ‚îÄ Generate button click ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const genBtn = document.getElementById('digest-generate-btn');
      if (genBtn) {
        genBtn.addEventListener('click', () => {
          const prefs = getPrefsD();
          if (!hasPrefsD(prefs)) { renderDigest(); return; }

          const items   = generateDigestJobs(prefs);
          const dateStr = todayLabel();

          if (items.length === 0) {
            document.getElementById('digest-generate-area').style.display = 'none';
            document.getElementById('digest-no-matches').style.display = '';
            document.getElementById('digest-card').style.display = 'none';
            document.getElementById('digest-actions').style.display = 'none';
            return;
          }

          // Persist to localStorage keyed by today's date
          const key = todayKey();
          localStorage.setItem(key, JSON.stringify({ items, dateStr }));

          paintDigest(items, dateStr);
        });
      }

      // Expose renderDigest so the router IIFE can call it
      window._renderDigest = renderDigest;

    })();
  </script>

  <!-- ‚îÄ‚îÄ Toast notification (Phase 7) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="status-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true"></div>


  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PHASE 8 ‚Äî TEST CHECKLIST + SHIP LOCK
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
    (() => {
      'use strict';

      const CHECKLIST_KEY = 'jnt_test_checklist';
      const TOTAL = 10;

      const ITEMS = [
        { id: 'pref-persist',    label: 'Preferences persist after refresh',       tip: 'Settings ‚Üí save prefs ‚Üí refresh ‚Üí re-open Settings. Values remain.' },
        { id: 'match-score',     label: 'Match score calculates correctly',         tip: 'Set a keyword matching a job title. That job shows a colored badge on Dashboard.' },
        { id: 'toggle-works',   label: '‚ÄúShow only matches‚Äù toggle works',          tip: 'Enable threshold toggle on Dashboard. Only jobs at/above your score appear.' },
        { id: 'save-persist',   label: 'Save job persists after refresh',           tip: 'Save a job ‚Üí refresh ‚Üí go to Saved. Job is still listed.' },
        { id: 'apply-tab',      label: 'Apply opens in new tab',                    tip: 'Click Apply ‚Üó on any card. Should open in a new browser tab.' },
        { id: 'status-persist', label: 'Status update persists after refresh',      tip: 'Set a job to Applied ‚Üí refresh. Still shows Applied.' },
        { id: 'status-filter',  label: 'Status filter works correctly',             tip: 'Mark 2+ jobs Applied. Filter by Applied. Only those jobs show.' },
        { id: 'digest-top10',   label: 'Digest generates top 10 by score',          tip: 'Go to Digest ‚Üí generate. List shows ‚â§10 jobs sorted by match score.' },
        { id: 'digest-persist', label: 'Digest persists for the day',               tip: 'Generate digest ‚Üí refresh ‚Üí visit Digest. Same list loads without clicking Generate.' },
        { id: 'no-errors',      label: 'No console errors on main pages',           tip: 'Open DevTools (F12) ‚Üí visit /, /dashboard, /saved, /digest, /settings. No red errors.' },
      ];

      function getChecked() {
        try {
          const raw = localStorage.getItem(CHECKLIST_KEY);
          return new Set(raw ? JSON.parse(raw) : []);
        } catch { return new Set(); }
      }

      function setChecked(set) {
        localStorage.setItem(CHECKLIST_KEY, JSON.stringify([...set]));
      }

      let checked = getChecked();

      // ‚îÄ‚îÄ Render the checklist page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderTest() {
        checked = getChecked();
        const count = checked.size;

        const scoreEl = document.getElementById('tc-score');
        if (scoreEl) scoreEl.textContent = `Tests Passed: ${count} / ${TOTAL}`;

        const warnEl = document.getElementById('tc-warn');
        if (warnEl) warnEl.style.display = count < TOTAL ? '' : 'none';

        const scoreSpan = document.getElementById('tc-score');
        if (scoreSpan) {
          scoreSpan.className = 'tc-summary__score' + (count === TOTAL ? ' tc-summary__score--all' : '');
        }

        const list = document.getElementById('tc-list');
        if (!list) return;
        list.innerHTML = ITEMS.map((item, i) => {
          const isChecked = checked.has(item.id);
          return `
            <li class="tc-item${isChecked ? ' tc-item--done' : ''}" role="listitem">
              <label class="tc-item__label">
                <input
                  type="checkbox"
                  class="tc-item__checkbox"
                  data-tc-id="${item.id}"
                  ${isChecked ? 'checked' : ''}
                  aria-label="Test ${i + 1}: ${item.label}"
                />
                <span class="tc-item__num">${String(i + 1).padStart(2, '0')}</span>
                <span class="tc-item__text">${item.label}</span>
              </label>
              <button
                class="tc-item__tip-btn"
                type="button"
                aria-label="How to test: ${item.label}"
                title="${item.tip}"
              >?</button>
              <span class="tc-item__tip-text" role="tooltip">${item.tip}</span>
            </li>`;
        }).join('');
      }

      // ‚îÄ‚îÄ Render the ship lock / unlock page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderShip() {
        checked = getChecked();
        const count = checked.size;
        const allPassed = count >= TOTAL;

        const lockedEl   = document.getElementById('ship-locked');
        const unlockedEl = document.getElementById('ship-unlocked');
        if (lockedEl)   lockedEl.style.display   = allPassed ? 'none' : '';
        if (unlockedEl) unlockedEl.style.display = allPassed ? '' : 'none';

        const bar   = document.getElementById('ship-progress-bar');
        const label = document.getElementById('ship-progress-label');
        if (bar)   bar.style.width   = `${Math.round((count / TOTAL) * 100)}%`;
        if (label) label.textContent = `${count} / ${TOTAL} tests passed`;
      }

      // ‚îÄ‚îÄ Event delegation for checklist checkboxes ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      document.addEventListener('change', e => {
        const cb = e.target.closest('[data-tc-id]');
        if (!cb) return;
        checked = getChecked();
        if (cb.checked) { checked.add(cb.dataset.tcId); }
        else            { checked.delete(cb.dataset.tcId); }
        setChecked(checked);
        renderTest();
      });

      // ‚îÄ‚îÄ Tooltip button toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      document.addEventListener('click', e => {
        const tipBtn = e.target.closest('.tc-item__tip-btn');
        if (!tipBtn) return;
        const li  = tipBtn.closest('.tc-item');
        const tip = li && li.querySelector('.tc-item__tip-text');
        if (!tip) return;
        const isOpen = tip.classList.contains('is-open');
        // Close all others first
        document.querySelectorAll('.tc-item__tip-text.is-open').forEach(t => t.classList.remove('is-open'));
        if (!isOpen) tip.classList.add('is-open');
      });

      // ‚îÄ‚îÄ Reset button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const resetBtn = document.getElementById('tc-reset-btn');
      if (resetBtn) {
        resetBtn.addEventListener('click', () => {
          localStorage.removeItem(CHECKLIST_KEY);
          checked = new Set();
          renderTest();
        });
      }

      window._renderTest = renderTest;
      window._renderShip = renderShip;

      // Self-init: router has already fired before this script ran,
      // so render immediately if we're already on one of these routes.
      (() => {
        const h = (window.location.hash || '').slice(1);
        if (h === '/jt/07-test') renderTest();
        if (h === '/jt/08-ship') renderShip();
      })();

    })();
  </script>


  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PHASE 9 ‚Äî PROOF PAGE + FINAL SUBMISSION
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
    (() => {
      'use strict';

      const PROOF_KEY      = 'jnt_proof_links';
      const CHECKLIST_KEY9 = 'jnt_test_checklist';
      const TOTAL_TESTS    = 10;

      const STEPS = [
        { label: 'Design System ‚Äî tokens, base, components, layout, states',  done: () => true },
        { label: 'Hash Router ‚Äî 8 routes, no framework',                        done: () => true },
        { label: 'Landing Page + Real Content',                                 done: () => true },
        { label: '60-job Dataset + Dashboard + Filter + Modal',                 done: () => (window.JOBS || []).length >= 60 },
        { label: 'Preferences Engine + Match Scoring',                          done: () => !!localStorage.getItem('jobTrackerPreferences') },
        { label: 'Daily Digest Engine + Clipboard + Email',                     done: () => Object.keys(localStorage).some(k => k.startsWith('jobTrackerDigest_')) },
        { label: 'Status Tracking + Toast Notifications',                       done: () => !!localStorage.getItem('jobTrackerStatus') },
        { label: 'Test Checklist + Ship Lock',                                  done: () => { try { return JSON.parse(localStorage.getItem(CHECKLIST_KEY9)||'[]').length > 0; } catch { return false; } } },
      ];

      function getLinks() {
        try { return JSON.parse(localStorage.getItem(PROOF_KEY) || '{}'); }
        catch { return {}; }
      }

      function setLinks(obj) {
        localStorage.setItem(PROOF_KEY, JSON.stringify(obj));
      }

      function isValidUrl(v) {
        try { const u = new URL(v); return u.protocol === 'http:' || u.protocol === 'https:'; }
        catch { return false; }
      }

      function getTestCount() {
        try { return JSON.parse(localStorage.getItem(CHECKLIST_KEY9) || '[]').length; }
        catch { return 0; }
      }

      // ‚îÄ‚îÄ Compute overall ship status ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function computeStatus(links, testCount) {
        const hasRequired = !!(links.github && links.deployed);
        const allTests = testCount >= TOTAL_TESTS;
        if (hasRequired && allTests)   return 'Shipped';
        if (hasRequired || testCount > 0 || links.lovable || links.github || links.deployed)
          return 'In Progress';
        return 'Not Started';
      }

      // ‚îÄ‚îÄ Build submission text ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function buildSubmissionText(links) {
        return [
          '------------------------------------------',
          'Job Notification Tracker ‚Äî Final Submission',
          '',
          ...(links.lovable ? ['Lovable Project:', links.lovable, ''] : []),
          'GitHub Repository:',
          links.github   || '(not provided)',
          '',
          'Live Deployment:',
          links.deployed || '(not provided)',
          '',
          'Core Features:',
          '- Intelligent match scoring',
          '- Daily digest simulation',
          '- Status tracking',
          '- Test checklist enforced',
          '------------------------------------------',
        ].join('\n');
      }

      // ‚îÄ‚îÄ Main render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      function renderProof() {
        const links     = getLinks();
        const testCount = getTestCount();
        const status    = computeStatus(links, testCount);

        // ‚îÄ Badge ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const badge = document.getElementById('proof-badge');
        if (badge) {
          badge.textContent = status;
          badge.className   = 'proof-badge proof-badge--' +
            (status === 'Shipped'     ? 'shipped' :
             status === 'In Progress' ? 'progress' : 'not-started');
        }

        // ‚îÄ Shipped message ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const shipMsg = document.getElementById('proof-shipped-msg');
        if (shipMsg) shipMsg.style.display = status === 'Shipped' ? '' : 'none';

        // ‚îÄ Steps ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const stepsList = document.getElementById('proof-steps');
        if (stepsList) {
          stepsList.innerHTML = STEPS.map((s, i) => {
            const isDone = s.done();
            return `
              <li class="proof-step${isDone ? ' proof-step--done' : ''}" role="listitem">
                <span class="proof-step__num">${String(i + 1).padStart(2, '0')}</span>
                <span class="proof-step__label">${s.label}</span>
                <span class="proof-step__status ${isDone ? 'proof-step__status--done' : 'proof-step__status--pending'}">
                  ${isDone ? '&#10003; Completed' : 'Pending'}
                </span>
              </li>`;
          }).join('');
        }

        // ‚îÄ Prefill inputs from localStorage ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        ['lovable','github','deployed'].forEach(key => {
          const inp = document.getElementById(`proof-${key}`);
          if (inp && links[key]) inp.value = links[key];
          const savedEl = document.getElementById(`proof-${key}-saved`);
          if (savedEl) savedEl.textContent = links[key] ? '\u2713 Saved' : '';
        });

        // ‚îÄ Submission preview ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const preview = document.getElementById('proof-preview');
        if (preview) preview.textContent = buildSubmissionText(links);
      }

      // ‚îÄ‚îÄ Save button handler (event delegation) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      document.addEventListener('click', e => {
        const saveBtn = e.target.closest('[data-proof-save]');
        if (!saveBtn) return;
        const key = saveBtn.dataset.proofSave;
        const inp = document.getElementById(`proof-${key}`);
        const errEl  = document.getElementById(`proof-${key}-error`);
        const savedEl = document.getElementById(`proof-${key}-saved`);
        if (!inp) return;
        const val = inp.value.trim();
        if (!val || !isValidUrl(val)) {
          if (errEl) errEl.textContent = 'Enter a valid URL (must start with https://).';
          if (savedEl) savedEl.textContent = '';
          return;
        }
        if (errEl) errEl.textContent = '';
        const links = getLinks();
        links[key] = val;
        setLinks(links);
        if (savedEl) savedEl.textContent = '\u2713 Saved';
        renderProof();   // refresh badge + preview
      });

      // ‚îÄ‚îÄ Copy final submission button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const proofCopyBtn = document.getElementById('proof-copy-btn');
      if (proofCopyBtn) {
        proofCopyBtn.addEventListener('click', () => {
          const text = buildSubmissionText(getLinks());
          const msg  = document.getElementById('proof-copy-msg');
          const doCopy = () => {
            if (msg) { msg.style.display = ''; setTimeout(() => { msg.style.display = 'none'; }, 3000); }
          };
          if (navigator.clipboard) {
            navigator.clipboard.writeText(text).then(doCopy).catch(() => {
              fallbackCopy(text); doCopy();
            });
          } else { fallbackCopy(text); doCopy(); }
        });
      }

      function fallbackCopy(text) {
        const ta = document.createElement('textarea');
        ta.value = text; ta.style.position = 'fixed'; ta.style.opacity = '0';
        document.body.appendChild(ta); ta.select();
        document.execCommand('copy'); document.body.removeChild(ta);
      }

      window._renderProof = renderProof;

      // Self-init: render immediately if already on /proof
      if ((window.location.hash || '').slice(1) === '/proof') renderProof();

    })();
  </script>

</body>
</html>
